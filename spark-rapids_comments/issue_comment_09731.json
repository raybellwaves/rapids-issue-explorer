[
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1819505329",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/9731#issuecomment-1819505329",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9731",
        "id": 1819505329,
        "node_id": "IC_kwDOD7z77c5sc3Kx",
        "user": {
            "login": "andygrove",
            "id": 934084,
            "node_id": "MDQ6VXNlcjkzNDA4NA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/934084?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/andygrove",
            "html_url": "https://github.com/andygrove",
            "followers_url": "https://api.github.com/users/andygrove/followers",
            "following_url": "https://api.github.com/users/andygrove/following{/other_user}",
            "gists_url": "https://api.github.com/users/andygrove/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/andygrove/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/andygrove/subscriptions",
            "organizations_url": "https://api.github.com/users/andygrove/orgs",
            "repos_url": "https://api.github.com/users/andygrove/repos",
            "events_url": "https://api.github.com/users/andygrove/events{/privacy}",
            "received_events_url": "https://api.github.com/users/andygrove/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-11-20T17:26:02Z",
        "updated_at": "2023-11-20T17:26:02Z",
        "author_association": "CONTRIBUTOR",
        "body": "I modified the test to show the input that causes this error:\r\n\r\n```\r\n-Row(a='oN\u00cd[\\x87\\x01\u00e1e>\\x85', regexp_replace(a, .*$, PROD, 1)='PRODPROD\\x85PROD')\r\n+Row(a='oN\u00cd[\\x87\\x01\u00e1e>\\x85', regexp_replace(a, .*$, PROD, 1)='PROD\\x85PROD')\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1819505329/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1819519369",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/9731#issuecomment-1819519369",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9731",
        "id": 1819519369,
        "node_id": "IC_kwDOD7z77c5sc6mJ",
        "user": {
            "login": "andygrove",
            "id": 934084,
            "node_id": "MDQ6VXNlcjkzNDA4NA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/934084?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/andygrove",
            "html_url": "https://github.com/andygrove",
            "followers_url": "https://api.github.com/users/andygrove/followers",
            "following_url": "https://api.github.com/users/andygrove/following{/other_user}",
            "gists_url": "https://api.github.com/users/andygrove/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/andygrove/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/andygrove/subscriptions",
            "organizations_url": "https://api.github.com/users/andygrove/orgs",
            "repos_url": "https://api.github.com/users/andygrove/repos",
            "events_url": "https://api.github.com/users/andygrove/events{/privacy}",
            "received_events_url": "https://api.github.com/users/andygrove/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-11-20T17:35:28Z",
        "updated_at": "2023-11-20T17:52:59Z",
        "author_association": "CONTRIBUTOR",
        "body": "Simpler repro:\r\n\r\n```python\r\n    .with_special_case('a\\x85')\r\n```\r\n\r\n```\r\n-Row(a='a\\x85', regexp_replace(a, .*$, PROD, 1)='PRODPROD\\x85PROD')\r\n+Row(a='a\\x85', regexp_replace(a, .*$, PROD, 1)='PROD\\x85PROD')\r\n```\r\n\r\nNote that `a\\x84` works fine, so this appears to be specific to certain characters.",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1819519369/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1863591532",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/9731#issuecomment-1863591532",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9731",
        "id": 1863591532,
        "node_id": "IC_kwDOD7z77c5vFCZs",
        "user": {
            "login": "andygrove",
            "id": 934084,
            "node_id": "MDQ6VXNlcjkzNDA4NA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/934084?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/andygrove",
            "html_url": "https://github.com/andygrove",
            "followers_url": "https://api.github.com/users/andygrove/followers",
            "following_url": "https://api.github.com/users/andygrove/following{/other_user}",
            "gists_url": "https://api.github.com/users/andygrove/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/andygrove/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/andygrove/subscriptions",
            "organizations_url": "https://api.github.com/users/andygrove/orgs",
            "repos_url": "https://api.github.com/users/andygrove/repos",
            "events_url": "https://api.github.com/users/andygrove/events{/privacy}",
            "received_events_url": "https://api.github.com/users/andygrove/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-12-19T23:02:45Z",
        "updated_at": "2023-12-19T23:02:45Z",
        "author_association": "CONTRIBUTOR",
        "body": "Adding the triage label back now that there is a summary of the issue. ",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1863591532/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1869776982",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/9731#issuecomment-1869776982",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9731",
        "id": 1869776982,
        "node_id": "IC_kwDOD7z77c5vcohW",
        "user": {
            "login": "sameerz",
            "id": 7036315,
            "node_id": "MDQ6VXNlcjcwMzYzMTU=",
            "avatar_url": "https://avatars.githubusercontent.com/u/7036315?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/sameerz",
            "html_url": "https://github.com/sameerz",
            "followers_url": "https://api.github.com/users/sameerz/followers",
            "following_url": "https://api.github.com/users/sameerz/following{/other_user}",
            "gists_url": "https://api.github.com/users/sameerz/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/sameerz/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/sameerz/subscriptions",
            "organizations_url": "https://api.github.com/users/sameerz/orgs",
            "repos_url": "https://api.github.com/users/sameerz/repos",
            "events_url": "https://api.github.com/users/sameerz/events{/privacy}",
            "received_events_url": "https://api.github.com/users/sameerz/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-12-26T21:18:42Z",
        "updated_at": "2023-12-26T21:18:42Z",
        "author_association": "COLLABORATOR",
        "body": "Need to investigate why we got \\x85 as an input string, since it is not a valid UTF-8 string.  ",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1869776982/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1869800880",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/9731#issuecomment-1869800880",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9731",
        "id": 1869800880,
        "node_id": "IC_kwDOD7z77c5vcuWw",
        "user": {
            "login": "revans2",
            "id": 3441321,
            "node_id": "MDQ6VXNlcjM0NDEzMjE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3441321?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/revans2",
            "html_url": "https://github.com/revans2",
            "followers_url": "https://api.github.com/users/revans2/followers",
            "following_url": "https://api.github.com/users/revans2/following{/other_user}",
            "gists_url": "https://api.github.com/users/revans2/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/revans2/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/revans2/subscriptions",
            "organizations_url": "https://api.github.com/users/revans2/orgs",
            "repos_url": "https://api.github.com/users/revans2/repos",
            "events_url": "https://api.github.com/users/revans2/events{/privacy}",
            "received_events_url": "https://api.github.com/users/revans2/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-12-26T22:25:39Z",
        "updated_at": "2023-12-26T22:25:39Z",
        "author_association": "COLLABORATOR",
        "body": "It looks like this might be related to how Spark/Python interprets the string 'a\\x85'. \r\n\r\n```\r\nimport pyspark.sql.types\r\n\r\ndf = spark.createDataFrame(SparkContext.getOrCreate().parallelize([(\"a\\x85\")]), pyspark.sql.types.StringType())\r\nspark.conf.set(\"spark.rapids.sql.enabled\", False)\r\ndf.selectExpr('CAST(value as BINARY)').show()\r\n+----------+\r\n|     value|\r\n+----------+\r\n|[61 C2 85]|\r\n+----------+\r\n\r\n```\r\n\r\n[C2 85] is the UTF-8 encoded character that is the same as \"\\u0085\", which is Next Line - NEL. The result, when it is pulled back into Spark converts the `[C2 85]` back to latin1 as an \"\\x85\" in python.\r\n\r\nSo it looks like a kind of odd situation where `.*$` is behaving differently for `NEL` compared to `\\n`.\r\n\r\n```\r\nimport pyspark.sql.types\r\ndf = spark.createDataFrame(SparkContext.getOrCreate().parallelize([(\"a\\x85\"), (\"a\\n\")]), pyspark.sql.types.StringType())\r\nspark.conf.set(\"spark.rapids.sql.enabled\", True)\r\ndf.selectExpr(\"CAST(regexp_replace(value, '.*$', 'P', 1) AS BINARY) as p\").show(truncate=False)\r\n+-------------+\r\n|p            |\r\n+-------------+\r\n|[50 C2 85 50]|\r\n|[50 50 0A 50]|\r\n+-------------+\r\n\r\nspark.conf.set(\"spark.rapids.sql.enabled\", False)\r\ndf.selectExpr(\"CAST(regexp_replace(value, '.*$', 'P', 1) AS BINARY) as p\").show(truncate=False)\r\n+----------------+\r\n|p               |\r\n+----------------+\r\n|[50 50 C2 85 50]|\r\n|[50 50 0A 50]   |\r\n+----------------+\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1869800880/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1883963913",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/9731#issuecomment-1883963913",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9731",
        "id": 1883963913,
        "node_id": "IC_kwDOD7z77c5wSwIJ",
        "user": {
            "login": "NVnavkumar",
            "id": 97137715,
            "node_id": "U_kgDOBco0Mw",
            "avatar_url": "https://avatars.githubusercontent.com/u/97137715?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/NVnavkumar",
            "html_url": "https://github.com/NVnavkumar",
            "followers_url": "https://api.github.com/users/NVnavkumar/followers",
            "following_url": "https://api.github.com/users/NVnavkumar/following{/other_user}",
            "gists_url": "https://api.github.com/users/NVnavkumar/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/NVnavkumar/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/NVnavkumar/subscriptions",
            "organizations_url": "https://api.github.com/users/NVnavkumar/orgs",
            "repos_url": "https://api.github.com/users/NVnavkumar/repos",
            "events_url": "https://api.github.com/users/NVnavkumar/events{/privacy}",
            "received_events_url": "https://api.github.com/users/NVnavkumar/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2024-01-09T23:38:02Z",
        "updated_at": "2024-01-09T23:38:02Z",
        "author_association": "COLLABORATOR",
        "body": "Note that `\\u0085` is recognized as a valid line terminator: https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html\r\n\r\n```\r\nA line terminator is a one- or two-character sequence that marks the end of a line of the input character sequence. The following are recognized as line terminators:\r\n\r\nA newline (line feed) character ('\\n'),\r\nA carriage-return character followed immediately by a newline character (\"\\r\\n\"),\r\nA standalone carriage-return character ('\\r'),\r\nA next-line character ('\\u0085'),\r\nA line-separator character ('\\u2028'), or\r\nA paragraph-separator character ('\\u2029).\r\n```\r\n\r\nSo the replace in this case is not actually working properly on the GPU. \r\n\r\nAlso, Python 3 strings are by default UTF-8, so `a\\x85` and `a\\u0085` are equivalent as strings, Python just displays as `'a\\x85'`, so it's not latin1.",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1883963913/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1905058986",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/9731#issuecomment-1905058986",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9731",
        "id": 1905058986,
        "node_id": "IC_kwDOD7z77c5xjOSq",
        "user": {
            "login": "andygrove",
            "id": 934084,
            "node_id": "MDQ6VXNlcjkzNDA4NA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/934084?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/andygrove",
            "html_url": "https://github.com/andygrove",
            "followers_url": "https://api.github.com/users/andygrove/followers",
            "following_url": "https://api.github.com/users/andygrove/following{/other_user}",
            "gists_url": "https://api.github.com/users/andygrove/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/andygrove/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/andygrove/subscriptions",
            "organizations_url": "https://api.github.com/users/andygrove/orgs",
            "repos_url": "https://api.github.com/users/andygrove/repos",
            "events_url": "https://api.github.com/users/andygrove/events{/privacy}",
            "received_events_url": "https://api.github.com/users/andygrove/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2024-01-23T00:10:43Z",
        "updated_at": "2024-01-23T00:10:43Z",
        "author_association": "CONTRIBUTOR",
        "body": "Note that we transpile the pattern `.*$` to `[^\\n\\r\\u0085\\u2028\\u2029]*(?:\\r|\\u0085|\\u2028|\\u2029|\\r\\n)?$` before passing to cuDF, so maybe we need to update this to handle `NEL`. I am investigating.",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1905058986/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1905103059",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/9731#issuecomment-1905103059",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9731",
        "id": 1905103059,
        "node_id": "IC_kwDOD7z77c5xjZDT",
        "user": {
            "login": "andygrove",
            "id": 934084,
            "node_id": "MDQ6VXNlcjkzNDA4NA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/934084?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/andygrove",
            "html_url": "https://github.com/andygrove",
            "followers_url": "https://api.github.com/users/andygrove/followers",
            "following_url": "https://api.github.com/users/andygrove/following{/other_user}",
            "gists_url": "https://api.github.com/users/andygrove/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/andygrove/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/andygrove/subscriptions",
            "organizations_url": "https://api.github.com/users/andygrove/orgs",
            "repos_url": "https://api.github.com/users/andygrove/repos",
            "events_url": "https://api.github.com/users/andygrove/events{/privacy}",
            "received_events_url": "https://api.github.com/users/andygrove/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2024-01-23T00:57:57Z",
        "updated_at": "2024-01-23T00:57:57Z",
        "author_association": "CONTRIBUTOR",
        "body": "cuDF repro:\r\n\r\n```java\r\n@Test\r\nvoid testStringReplaceEdgeCase() {\r\n    TableDebug debug = TableDebug.builder().build();\r\n    RegexProgram target = new RegexProgram(\r\n            \"[^\\n\\r\\u0085\\uc285\\u2028\\u2029]*(?:\\r|\\u0085|\\uc285|\\u2028|\\u2029|\\r\\n)?$\");\r\n    try (ColumnVector input = ColumnVector.fromStrings(\"a\\n\", \"a\\u0085\");\r\n         ColumnVector expected = ColumnVector.fromStrings(\"PRODPROD\\nPROD\", \"PRODPROD\\u0085PROD\");\r\n         Scalar replace = Scalar.fromString(\"PROD\");\r\n         ColumnVector output = input.replaceRegex(target, replace)) {\r\n        debug.debug(\"input\", input);\r\n        debug.debug(\"output\", output);\r\n        assertColumnsAreEqual(expected, output);\r\n    }\r\n}\r\n```\r\n\r\nOutput:\r\n\r\n```\r\nGPU COLUMN input - NC: 0 DATA: DeviceMemoryBufferView{address=0x7f7e86000000, length=5, id=-1} VAL: null\r\nCOLUMN input - STRING\r\n0 \"a\r\n\" 610a\r\n1 \"a<85>\" 61c285\r\nGPU COLUMN output - NC: 0 DATA: DeviceMemoryBufferView{address=0x7f7e86000a00, length=21, id=-1} VAL: null\r\nCOLUMN output - STRING\r\n0 \"PRODPROD\r\nPROD\" 50524f4450524f440a50524f44\r\n1 \"PRODPROD\" 50524f4450524f44\r\nHOST PADDING SIZE: 32\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1905103059/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1905106209",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/9731#issuecomment-1905106209",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9731",
        "id": 1905106209,
        "node_id": "IC_kwDOD7z77c5xjZ0h",
        "user": {
            "login": "andygrove",
            "id": 934084,
            "node_id": "MDQ6VXNlcjkzNDA4NA==",
            "avatar_url": "https://avatars.githubusercontent.com/u/934084?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/andygrove",
            "html_url": "https://github.com/andygrove",
            "followers_url": "https://api.github.com/users/andygrove/followers",
            "following_url": "https://api.github.com/users/andygrove/following{/other_user}",
            "gists_url": "https://api.github.com/users/andygrove/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/andygrove/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/andygrove/subscriptions",
            "organizations_url": "https://api.github.com/users/andygrove/orgs",
            "repos_url": "https://api.github.com/users/andygrove/repos",
            "events_url": "https://api.github.com/users/andygrove/events{/privacy}",
            "received_events_url": "https://api.github.com/users/andygrove/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2024-01-23T01:01:55Z",
        "updated_at": "2024-01-23T01:01:55Z",
        "author_association": "CONTRIBUTOR",
        "body": "@NVnavkumar based on the test I posted here, I am not sure if this is really a bug in cuDF or not. What do you think?",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1905106209/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]