[
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1163557044",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/5478#issuecomment-1163557044",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5478",
        "id": 1163557044,
        "node_id": "IC_kwDOD7z77c5FWni0",
        "user": {
            "login": "anthony-chang",
            "id": 54450499,
            "node_id": "MDQ6VXNlcjU0NDUwNDk5",
            "avatar_url": "https://avatars.githubusercontent.com/u/54450499?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/anthony-chang",
            "html_url": "https://github.com/anthony-chang",
            "followers_url": "https://api.github.com/users/anthony-chang/followers",
            "following_url": "https://api.github.com/users/anthony-chang/following{/other_user}",
            "gists_url": "https://api.github.com/users/anthony-chang/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/anthony-chang/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/anthony-chang/subscriptions",
            "organizations_url": "https://api.github.com/users/anthony-chang/orgs",
            "repos_url": "https://api.github.com/users/anthony-chang/repos",
            "events_url": "https://api.github.com/users/anthony-chang/events{/privacy}",
            "received_events_url": "https://api.github.com/users/anthony-chang/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-06-22T20:14:07Z",
        "updated_at": "2022-06-22T20:14:07Z",
        "author_association": "CONTRIBUTOR",
        "body": "Depends on https://github.com/rapidsai/cudf/issues/11102",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1163557044/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1189626759",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/5478#issuecomment-1189626759",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5478",
        "id": 1189626759,
        "node_id": "IC_kwDOD7z77c5G6EOH",
        "user": {
            "login": "anthony-chang",
            "id": 54450499,
            "node_id": "MDQ6VXNlcjU0NDUwNDk5",
            "avatar_url": "https://avatars.githubusercontent.com/u/54450499?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/anthony-chang",
            "html_url": "https://github.com/anthony-chang",
            "followers_url": "https://api.github.com/users/anthony-chang/followers",
            "following_url": "https://api.github.com/users/anthony-chang/following{/other_user}",
            "gists_url": "https://api.github.com/users/anthony-chang/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/anthony-chang/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/anthony-chang/subscriptions",
            "organizations_url": "https://api.github.com/users/anthony-chang/orgs",
            "repos_url": "https://api.github.com/users/anthony-chang/repos",
            "events_url": "https://api.github.com/users/anthony-chang/events{/privacy}",
            "received_events_url": "https://api.github.com/users/anthony-chang/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2022-07-19T22:53:09Z",
        "updated_at": "2022-07-19T22:53:09Z",
        "author_association": "CONTRIBUTOR",
        "body": "There are still a number of inconsistencies, particularly when the pattern consists entirely of word boundaries. cuDF/python has an extra empty token in the array returned by string split which Spark does not. Examples:\r\n\r\n```\r\n- \\b *** FAILED ***\r\n  string_split pattern=\\b isRegex=true data=a limit=-1 \r\n  CPU [2]: a,  \r\n  GPU [3]: , a, (RegularExpressionTranspilerSuite.scala:764)\r\n\r\n- \\b\\b *** FAILED ***\r\n  string_split pattern=\\b\\b isRegex=true data=a limit=-1 \r\n  CPU [2]: a,  \r\n  GPU [3]: , a, (RegularExpressionTranspilerSuite.scala:764)\r\n\r\n- \\B\\B *** FAILED ***\r\n  string_split pattern=\\B\\B isRegex=true data=-+ limit=-1 \r\n  CPU [3]: -, +,  \r\n  GPU [4]: , -, +, (RegularExpressionTranspilerSuite.scala:764)\r\n```\r\n\r\nIt is possible to use a workaround for this though. We can check if the pattern consists of entirely word or non-word boundaries:\r\n```scala\r\ndef isEntirely(pattern: RegexAST, component: RegexAST): Boolean = {\r\n  pattern match {\r\n    case RegexSequence(parts) => parts.forall(isEntirely(_, component))\r\n    case RegexGroup(_, term) => isEntirely(term, component)\r\n    case RegexChoice(l, r) => isEntirely(l, component) || isEntirely(r, component)\r\n    case `component` => true\r\n    case _ => false\r\n  }\r\n}\r\n\r\nval isEntirelyWordBoundary = isEntirely(ast, RegexEscaped('b')) || isEntirely(ast, RegexEscaped('B'))\r\n```\r\nLet `arr` be the string array we get from cuDF's string split. If `isEntirelyWordBoundary && arr.length > 1 && arr.head = \"\"` is true, then we can remove the first element in `arr` and it will match the Spark string split. This method passed the Scala fuzz tests for `limit <= 1`.\r\n\r\nFor `limit > 1` this wouldn't work since removing an element would be like removing one of the splits. We could try to work around this by running the split with `limit = limit + 1` but the conditions for when to do this are even more complicated. \r\n\r\nChecking all these conditions on GPU and then doing the removal from a list column vector will be extremely complicated so I don't see a good way to implement this functionality as of now. \r\n",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1189626759/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]