[
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1564380305",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/8403#issuecomment-1564380305",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8403",
        "id": 1564380305,
        "node_id": "IC_kwDOD7z77c5dPoyR",
        "user": {
            "login": "abellina",
            "id": 1901059,
            "node_id": "MDQ6VXNlcjE5MDEwNTk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1901059?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/abellina",
            "html_url": "https://github.com/abellina",
            "followers_url": "https://api.github.com/users/abellina/followers",
            "following_url": "https://api.github.com/users/abellina/following{/other_user}",
            "gists_url": "https://api.github.com/users/abellina/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/abellina/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/abellina/subscriptions",
            "organizations_url": "https://api.github.com/users/abellina/orgs",
            "repos_url": "https://api.github.com/users/abellina/repos",
            "events_url": "https://api.github.com/users/abellina/events{/privacy}",
            "received_events_url": "https://api.github.com/users/abellina/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-05-26T13:16:02Z",
        "updated_at": "2023-05-26T13:16:02Z",
        "author_association": "COLLABORATOR",
        "body": "This test was recently added here: https://github.com/NVIDIA/spark-rapids/pull/8371",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1564380305/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1564429928",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/8403#issuecomment-1564429928",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8403",
        "id": 1564429928,
        "node_id": "IC_kwDOD7z77c5dP05o",
        "user": {
            "login": "abellina",
            "id": 1901059,
            "node_id": "MDQ6VXNlcjE5MDEwNTk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1901059?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/abellina",
            "html_url": "https://github.com/abellina",
            "followers_url": "https://api.github.com/users/abellina/followers",
            "following_url": "https://api.github.com/users/abellina/following{/other_user}",
            "gists_url": "https://api.github.com/users/abellina/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/abellina/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/abellina/subscriptions",
            "organizations_url": "https://api.github.com/users/abellina/orgs",
            "repos_url": "https://api.github.com/users/abellina/repos",
            "events_url": "https://api.github.com/users/abellina/events{/privacy}",
            "received_events_url": "https://api.github.com/users/abellina/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-05-26T13:53:30Z",
        "updated_at": "2023-05-26T13:53:30Z",
        "author_association": "COLLABORATOR",
        "body": "This repros against a standalone cluster without the multi-threaded cluster.",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1564429928/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1564534488",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/8403#issuecomment-1564534488",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8403",
        "id": 1564534488,
        "node_id": "IC_kwDOD7z77c5dQObY",
        "user": {
            "login": "abellina",
            "id": 1901059,
            "node_id": "MDQ6VXNlcjE5MDEwNTk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1901059?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/abellina",
            "html_url": "https://github.com/abellina",
            "followers_url": "https://api.github.com/users/abellina/followers",
            "following_url": "https://api.github.com/users/abellina/following{/other_user}",
            "gists_url": "https://api.github.com/users/abellina/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/abellina/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/abellina/subscriptions",
            "organizations_url": "https://api.github.com/users/abellina/orgs",
            "repos_url": "https://api.github.com/users/abellina/repos",
            "events_url": "https://api.github.com/users/abellina/events{/privacy}",
            "received_events_url": "https://api.github.com/users/abellina/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-05-26T15:06:51Z",
        "updated_at": "2023-05-26T15:06:51Z",
        "author_association": "COLLABORATOR",
        "body": "Trying to come up with a smaller repro, but I ended up with this: https://github.com/NVIDIA/spark-rapids/issues/8411",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1564534488/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1564567048",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/8403#issuecomment-1564567048",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8403",
        "id": 1564567048,
        "node_id": "IC_kwDOD7z77c5dQWYI",
        "user": {
            "login": "abellina",
            "id": 1901059,
            "node_id": "MDQ6VXNlcjE5MDEwNTk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1901059?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/abellina",
            "html_url": "https://github.com/abellina",
            "followers_url": "https://api.github.com/users/abellina/followers",
            "following_url": "https://api.github.com/users/abellina/following{/other_user}",
            "gists_url": "https://api.github.com/users/abellina/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/abellina/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/abellina/subscriptions",
            "organizations_url": "https://api.github.com/users/abellina/orgs",
            "repos_url": "https://api.github.com/users/abellina/repos",
            "events_url": "https://api.github.com/users/abellina/events{/privacy}",
            "received_events_url": "https://api.github.com/users/abellina/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-05-26T15:32:03Z",
        "updated_at": "2023-05-26T15:32:03Z",
        "author_association": "COLLABORATOR",
        "body": "Related (but not the whole) repro:\r\n\r\n```\r\nimport org.apache.spark.sql.types._\r\nval schema = StructType(Array(StructField(\"k0\", LongType, false), StructField(\"k1\", LongType, false), StructField(\"k2\", LongType, false), StructField(\"k3\", LongType, false), StructField(\"v0\", LongType, true), StructField(\"v1\", LongType, true), StructField(\"v2\", LongType, true), StructField(\"v3\", LongType, true)))\r\nval d = spark.read.schema(schema).json(\"file:///tmp/json_test_repro\")\r\nd.show()\r\n```\r\n\r\nWhere json_test_repro is a folder with a json file with contents:\r\n\r\n```\r\n{\"v1\":5139590093827188858,\"v2\":-1404180295742992878}\r\n```\r\n\r\nAnd partitioned directory structure, as such:\r\n\r\n```\r\n./k0=1\r\n./k0=1/k1=1\r\n./k0=1/k1=1/k2=2\r\n./k0=1/k1=1/k2=2/k3=3\r\n./k0=1/k1=1/k2=2/k3=3/part-00014-48dd252f-0dec-4969-ac53-79d4cb8a8331.c000.json\r\n```\r\n\r\nNote the schema passed to cuDF has columns v0, v3 that don't exist in the json itself. The issue with this we get back a table from cuDF with 2 columns, instead of 4 columns (after fixing https://github.com/NVIDIA/spark-rapids/issues/8411):\r\n\r\n```\r\njava.lang.ArrayIndexOutOfBoundsException: 2\r\n        at ai.rapids.cudf.Table.getColumn(Table.java:124)\r\n        at org.apache.spark.sql.catalyst.json.rapids.JsonPartitionReader.$anonfun$readToTable$4(GpuJsonScan.scala:326)\r\n        at scala.collection.IndexedSeqOptimized.foreach(IndexedSeqOptimized.scala:36)\r\n        at scala.collection.IndexedSeqOptimized.foreach$(IndexedSeqOptimized.scala:33)\r\n        at scala.collection.mutable.ArrayOps$ofRef.foreach(ArrayOps.scala:198)\r\n        at org.apache.spark.sql.catalyst.json.rapids.JsonPartitionReader.$anonfun$readToTable$3(GpuJsonScan.scala:319)\r\n        at com.nvidia.spark.rapids.Arm$.withResource(Arm.scala:29)\r\n```\r\n\r\nSince the files can have any number of columns (if all rows are null, Spark can omit the column), then we need to make sure cuDF follows suit.",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1564567048/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1564581113",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/8403#issuecomment-1564581113",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8403",
        "id": 1564581113,
        "node_id": "IC_kwDOD7z77c5dQZz5",
        "user": {
            "login": "abellina",
            "id": 1901059,
            "node_id": "MDQ6VXNlcjE5MDEwNTk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1901059?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/abellina",
            "html_url": "https://github.com/abellina",
            "followers_url": "https://api.github.com/users/abellina/followers",
            "following_url": "https://api.github.com/users/abellina/following{/other_user}",
            "gists_url": "https://api.github.com/users/abellina/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/abellina/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/abellina/subscriptions",
            "organizations_url": "https://api.github.com/users/abellina/orgs",
            "repos_url": "https://api.github.com/users/abellina/repos",
            "events_url": "https://api.github.com/users/abellina/events{/privacy}",
            "received_events_url": "https://api.github.com/users/abellina/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-05-26T15:39:35Z",
        "updated_at": "2023-05-26T15:39:35Z",
        "author_association": "COLLABORATOR",
        "body": "We need to file a cuDF bug for this. \r\n\r\nMy guess is that the integration test failure is an odd combination of contents of a source table. \r\n\r\nIf the file in question had the following contents:\r\n\r\n```\r\n{\"v0\":0, \"v1\":1, \"v2\":2, \"v3\":3}\r\n{\"v1\":5139590093827188858,\"v2\":-1404180295742992878}\r\n```\r\n\r\nWe get back 4 columns and all seems well:\r\n\r\n```\r\n+----+-------------------+--------------------+----+---+---+---+---+            \r\n|  v0|                 v1|                  v2|  v3| k0| k1| k2| k3|\r\n+----+-------------------+--------------------+----+---+---+---+---+\r\n|   0|                  1|                   2|   3|  1|  1|  2|  3|\r\n|null|5139590093827188858|-1404180295742992878|null|  1|  1|  2|  3|\r\n+----+-------------------+--------------------+----+---+---+---+---+\r\n```\r\n\r\nThe CPU consistently returns the above table with all columns and nulls where appropriate.",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1564581113/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1569010110",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/8403#issuecomment-1569010110",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8403",
        "id": 1569010110,
        "node_id": "IC_kwDOD7z77c5dhTG-",
        "user": {
            "login": "revans2",
            "id": 3441321,
            "node_id": "MDQ6VXNlcjM0NDEzMjE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3441321?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/revans2",
            "html_url": "https://github.com/revans2",
            "followers_url": "https://api.github.com/users/revans2/followers",
            "following_url": "https://api.github.com/users/revans2/following{/other_user}",
            "gists_url": "https://api.github.com/users/revans2/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/revans2/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/revans2/subscriptions",
            "organizations_url": "https://api.github.com/users/revans2/orgs",
            "repos_url": "https://api.github.com/users/revans2/repos",
            "events_url": "https://api.github.com/users/revans2/events{/privacy}",
            "received_events_url": "https://api.github.com/users/revans2/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-05-30T19:59:28Z",
        "updated_at": "2023-05-30T19:59:28Z",
        "author_association": "COLLABORATOR",
        "body": "Yes, this is a bug in our CUDF JNI layer.\r\n\r\nhttps://github.com/rapidsai/cudf/blob/5e12c25ca40c41f21fc80d4cd36713c514fabaa4/java/src/main/native/src/TableJni.cpp#L1504-L1521\r\n\r\nIf we cannot find a column that matches the name, we return the original data from unchanged.  We really should be moving columns over to a new table and generating columns of nulls if we cannot find the column we want.",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1569010110/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1569037135",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/8403#issuecomment-1569037135",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8403",
        "id": 1569037135,
        "node_id": "IC_kwDOD7z77c5dhZtP",
        "user": {
            "login": "revans2",
            "id": 3441321,
            "node_id": "MDQ6VXNlcjM0NDEzMjE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3441321?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/revans2",
            "html_url": "https://github.com/revans2",
            "followers_url": "https://api.github.com/users/revans2/followers",
            "following_url": "https://api.github.com/users/revans2/following{/other_user}",
            "gists_url": "https://api.github.com/users/revans2/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/revans2/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/revans2/subscriptions",
            "organizations_url": "https://api.github.com/users/revans2/orgs",
            "repos_url": "https://api.github.com/users/revans2/repos",
            "events_url": "https://api.github.com/users/revans2/events{/privacy}",
            "received_events_url": "https://api.github.com/users/revans2/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-05-30T20:18:45Z",
        "updated_at": "2023-05-30T20:18:45Z",
        "author_association": "COLLABORATOR",
        "body": "From a performance/efficiency standpoint I think we want to modify where we reorder the columns.  I think we want to return a TableWithMeta, and let the java code handle the column names. This is so we can avoid copying the table multiple times and possibly making multiple copies of the same columns.",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1569037135/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1569089040",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/8403#issuecomment-1569089040",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8403",
        "id": 1569089040,
        "node_id": "IC_kwDOD7z77c5dhmYQ",
        "user": {
            "login": "revans2",
            "id": 3441321,
            "node_id": "MDQ6VXNlcjM0NDEzMjE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3441321?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/revans2",
            "html_url": "https://github.com/revans2",
            "followers_url": "https://api.github.com/users/revans2/followers",
            "following_url": "https://api.github.com/users/revans2/following{/other_user}",
            "gists_url": "https://api.github.com/users/revans2/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/revans2/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/revans2/subscriptions",
            "organizations_url": "https://api.github.com/users/revans2/orgs",
            "repos_url": "https://api.github.com/users/revans2/repos",
            "events_url": "https://api.github.com/users/revans2/events{/privacy}",
            "received_events_url": "https://api.github.com/users/revans2/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-05-30T20:55:04Z",
        "updated_at": "2023-05-30T20:55:04Z",
        "author_association": "COLLABORATOR",
        "body": "Crap. I don't know if we can fix it without pushing some of this back to the plugin or have CUDF actually return nulls for columns that were not in the file.\r\n\r\nI'll file an issue and see what CUDF has to say about it.",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1569089040/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1569148219",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/8403#issuecomment-1569148219",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8403",
        "id": 1569148219,
        "node_id": "IC_kwDOD7z77c5dh007",
        "user": {
            "login": "revans2",
            "id": 3441321,
            "node_id": "MDQ6VXNlcjM0NDEzMjE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3441321?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/revans2",
            "html_url": "https://github.com/revans2",
            "followers_url": "https://api.github.com/users/revans2/followers",
            "following_url": "https://api.github.com/users/revans2/following{/other_user}",
            "gists_url": "https://api.github.com/users/revans2/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/revans2/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/revans2/subscriptions",
            "organizations_url": "https://api.github.com/users/revans2/orgs",
            "repos_url": "https://api.github.com/users/revans2/repos",
            "events_url": "https://api.github.com/users/revans2/events{/privacy}",
            "received_events_url": "https://api.github.com/users/revans2/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2023-05-30T21:46:30Z",
        "updated_at": "2023-05-30T21:46:30Z",
        "author_association": "COLLABORATOR",
        "body": "I filed https://github.com/rapidsai/cudf/issues/13473 for the long term fix. In the short term I am going to do my best to make it work without it.  We will not be able to make the corner case of a file with no columns, only rows, work.",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/1569148219/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]