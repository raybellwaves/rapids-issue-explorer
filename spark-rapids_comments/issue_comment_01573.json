[
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/765560833",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/1573#issuecomment-765560833",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/1573",
        "id": 765560833,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc2NTU2MDgzMw==",
        "user": {
            "login": "revans2",
            "id": 3441321,
            "node_id": "MDQ6VXNlcjM0NDEzMjE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3441321?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/revans2",
            "html_url": "https://github.com/revans2",
            "followers_url": "https://api.github.com/users/revans2/followers",
            "following_url": "https://api.github.com/users/revans2/following{/other_user}",
            "gists_url": "https://api.github.com/users/revans2/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/revans2/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/revans2/subscriptions",
            "organizations_url": "https://api.github.com/users/revans2/orgs",
            "repos_url": "https://api.github.com/users/revans2/repos",
            "events_url": "https://api.github.com/users/revans2/events{/privacy}",
            "received_events_url": "https://api.github.com/users/revans2/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-01-22T17:11:39Z",
        "updated_at": "2021-01-22T17:11:39Z",
        "author_association": "COLLABORATOR",
        "body": "It is only ratio that is showing issues, but it is showing them in more than one place.",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/765560833/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/765570265",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/1573#issuecomment-765570265",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/1573",
        "id": 765570265,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc2NTU3MDI2NQ==",
        "user": {
            "login": "revans2",
            "id": 3441321,
            "node_id": "MDQ6VXNlcjM0NDEzMjE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3441321?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/revans2",
            "html_url": "https://github.com/revans2",
            "followers_url": "https://api.github.com/users/revans2/followers",
            "following_url": "https://api.github.com/users/revans2/following{/other_user}",
            "gists_url": "https://api.github.com/users/revans2/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/revans2/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/revans2/subscriptions",
            "organizations_url": "https://api.github.com/users/revans2/orgs",
            "repos_url": "https://api.github.com/users/revans2/repos",
            "events_url": "https://api.github.com/users/revans2/events{/privacy}",
            "received_events_url": "https://api.github.com/users/revans2/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-01-22T17:28:19Z",
        "updated_at": "2021-01-22T17:28:19Z",
        "author_association": "COLLABORATOR",
        "body": "It looks like round is doing the wrong thing for HALF_UP rounding. I expanded the input to it and it looks like `round(0.575, 2)` and `round(1.025, 2)` are doing the wrong thing on the GPU.  It is an explicit corner case that we should pay more attention to in the tests. I'll try and track this down to see what data types this impacts.\r\n\r\n",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/765570265/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/765575887",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/1573#issuecomment-765575887",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/1573",
        "id": 765575887,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc2NTU3NTg4Nw==",
        "user": {
            "login": "revans2",
            "id": 3441321,
            "node_id": "MDQ6VXNlcjM0NDEzMjE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3441321?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/revans2",
            "html_url": "https://github.com/revans2",
            "followers_url": "https://api.github.com/users/revans2/followers",
            "following_url": "https://api.github.com/users/revans2/following{/other_user}",
            "gists_url": "https://api.github.com/users/revans2/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/revans2/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/revans2/subscriptions",
            "organizations_url": "https://api.github.com/users/revans2/orgs",
            "repos_url": "https://api.github.com/users/revans2/repos",
            "events_url": "https://api.github.com/users/revans2/events{/privacy}",
            "received_events_url": "https://api.github.com/users/revans2/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-01-22T17:38:56Z",
        "updated_at": "2021-01-22T17:38:56Z",
        "author_association": "COLLABORATOR",
        "body": "I am going to keep pushing, but it looks like cudf is not doing the correct thing for rounding on some floating point values. Both float and double are impacted, but it looks like they are not impacted the same by similar results.\r\n\r\n```\r\nscala> Seq(1.025, 0.575, 2.005, 2.015, 2.025).toDF(\"f\").repartition(1).selectExpr(\"round(CAST(f AS FLOAT), 2)\").collect\r\n21/01/22 17:34:27 WARN GpuOverrides: \r\n*Exec <ProjectExec> could run on GPU\r\n  *Expression <Alias> round(cast(f#80 as float), 2) AS round(CAST(f AS FLOAT), 2)#82 could run on GPU\r\n    *Expression <Round> round(cast(f#80 as float), 2) could run on GPU\r\n      *Expression <Cast> cast(f#80 as float) could run on GPU\r\n  *Exec <ShuffleExchangeExec> could run on GPU\r\n    *Partitioning <RoundRobinPartitioning> could run on GPU\r\n    !NOT_FOUND <LocalTableScanExec> cannot run on GPU because no GPU enabled version of operator class org.apache.spark.sql.execution.LocalTableScanExec could be found\r\n\r\nres11: Array[org.apache.spark.sql.Row] = Array([0.58], [1.02], [2.01], [2.02], [2.03])\r\n\r\nscala> Seq(1.025, 0.575, 2.005, 2.015, 2.025).toDF(\"f\").repartition(1).selectExpr(\"round(CAST(f AS DOUBLE), 2)\").collect\r\n21/01/22 17:34:49 WARN GpuOverrides: \r\n*Exec <ProjectExec> could run on GPU\r\n  *Expression <Alias> round(f#90, 2) AS round(CAST(f AS DOUBLE), 2)#92 could run on GPU\r\n    *Expression <Round> round(f#90, 2) could run on GPU\r\n  *Exec <ShuffleExchangeExec> could run on GPU\r\n    *Partitioning <RoundRobinPartitioning> could run on GPU\r\n    !NOT_FOUND <LocalTableScanExec> cannot run on GPU because no GPU enabled version of operator class org.apache.spark.sql.execution.LocalTableScanExec could be found\r\n\r\nres12: Array[org.apache.spark.sql.Row] = Array([0.57], [1.02], [2.0], [2.02], [2.02])\r\n\r\nscala> Seq(1.025, 0.575, 2.005, 2.015, 2.025).toDF(\"f\").repartition(1).selectExpr(\"round(CAST(f AS DECIMAL(6, 3)), 2)\").collect\r\n21/01/22 17:35:23 WARN GpuOverrides: \r\n*Exec <ProjectExec> could run on GPU\r\n  *Expression <Alias> round(cast(f#100 as decimal(6,3)), 2) AS round(CAST(f AS DECIMAL(6,3)), 2)#102 could run on GPU\r\n    *Expression <Round> round(cast(f#100 as decimal(6,3)), 2) could run on GPU\r\n      *Expression <Cast> cast(f#100 as decimal(6,3)) could run on GPU\r\n  *Exec <ShuffleExchangeExec> could run on GPU\r\n    *Partitioning <RoundRobinPartitioning> could run on GPU\r\n    !NOT_FOUND <LocalTableScanExec> cannot run on GPU because no GPU enabled version of operator class org.apache.spark.sql.execution.LocalTableScanExec could be found\r\n\r\nres13: Array[org.apache.spark.sql.Row] = Array([0.58], [1.03], [2.01], [2.02], [2.03])\r\n```",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/765575887/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/765587505",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/1573#issuecomment-765587505",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/1573",
        "id": 765587505,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc2NTU4NzUwNQ==",
        "user": {
            "login": "revans2",
            "id": 3441321,
            "node_id": "MDQ6VXNlcjM0NDEzMjE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3441321?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/revans2",
            "html_url": "https://github.com/revans2",
            "followers_url": "https://api.github.com/users/revans2/followers",
            "following_url": "https://api.github.com/users/revans2/following{/other_user}",
            "gists_url": "https://api.github.com/users/revans2/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/revans2/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/revans2/subscriptions",
            "organizations_url": "https://api.github.com/users/revans2/orgs",
            "repos_url": "https://api.github.com/users/revans2/repos",
            "events_url": "https://api.github.com/users/revans2/events{/privacy}",
            "received_events_url": "https://api.github.com/users/revans2/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-01-22T17:59:42Z",
        "updated_at": "2021-01-22T17:59:42Z",
        "author_association": "COLLABORATOR",
        "body": "I filed https://github.com/rapidsai/cudf/issues/7195 for this in CUDF.",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/765587505/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    },
    {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/766889450",
        "html_url": "https://github.com/NVIDIA/spark-rapids/issues/1573#issuecomment-766889450",
        "issue_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/1573",
        "id": 766889450,
        "node_id": "MDEyOklzc3VlQ29tbWVudDc2Njg4OTQ1MA==",
        "user": {
            "login": "revans2",
            "id": 3441321,
            "node_id": "MDQ6VXNlcjM0NDEzMjE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3441321?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/revans2",
            "html_url": "https://github.com/revans2",
            "followers_url": "https://api.github.com/users/revans2/followers",
            "following_url": "https://api.github.com/users/revans2/following{/other_user}",
            "gists_url": "https://api.github.com/users/revans2/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/revans2/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/revans2/subscriptions",
            "organizations_url": "https://api.github.com/users/revans2/orgs",
            "repos_url": "https://api.github.com/users/revans2/repos",
            "events_url": "https://api.github.com/users/revans2/events{/privacy}",
            "received_events_url": "https://api.github.com/users/revans2/received_events",
            "type": "User",
            "site_admin": false
        },
        "created_at": "2021-01-25T15:19:09Z",
        "updated_at": "2021-01-25T15:19:09Z",
        "author_association": "COLLABORATOR",
        "body": "It turns out that rapidsai/cudf#7195 is not a bug. I filed the issue without doing enough due diligence.  It looks like the problem is with how Spark actually deals with rounding double values.\r\n\r\n```\r\nBigDecimal(d).setScale(_scale, mode).toDouble\r\n```\r\n\r\nWhen converting from a double to a decimal value Spark converts the double to a string.  And java does some funky things to turn the value into a String that we cannot replicate in cudf yet.  This means that I think we are going to have to fall back to the CPU for round/bround on double values by default until we can figure out a better way to cast double values to decimal values that matches spark exactly.",
        "reactions": {
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/comments/766889450/reactions",
            "total_count": 0,
            "+1": 0,
            "-1": 0,
            "laugh": 0,
            "hooray": 0,
            "confused": 0,
            "heart": 0,
            "rocket": 0,
            "eyes": 0
        },
        "performed_via_github_app": null
    }
]