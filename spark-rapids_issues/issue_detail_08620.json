{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8620",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8620/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8620/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8620/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/8620",
    "id": 1777807498,
    "node_id": "I_kwDOD7z77c5p9zCK",
    "number": 8620,
    "title": "[FEA] Understand why sort aggs are faster than hash aggs and ideally put it to good use",
    "user": {
        "login": "revans2",
        "id": 3441321,
        "node_id": "MDQ6VXNlcjM0NDEzMjE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3441321?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/revans2",
        "html_url": "https://github.com/revans2",
        "followers_url": "https://api.github.com/users/revans2/followers",
        "following_url": "https://api.github.com/users/revans2/following{/other_user}",
        "gists_url": "https://api.github.com/users/revans2/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/revans2/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/revans2/subscriptions",
        "organizations_url": "https://api.github.com/users/revans2/orgs",
        "repos_url": "https://api.github.com/users/revans2/repos",
        "events_url": "https://api.github.com/users/revans2/events{/privacy}",
        "received_events_url": "https://api.github.com/users/revans2/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2061735884,
            "node_id": "MDU6TGFiZWwyMDYxNzM1ODg0",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/feature%20request",
            "name": "feature request",
            "color": "a2eeef",
            "default": false,
            "description": "New feature or request"
        },
        {
            "id": 2094500742,
            "node_id": "MDU6TGFiZWwyMDk0NTAwNzQy",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/performance",
            "name": "performance",
            "color": "d845b1",
            "default": false,
            "description": "A performance related task/issue"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2023-06-27T21:54:17Z",
    "updated_at": "2023-07-05T21:34:04Z",
    "closed_at": null,
    "author_association": "COLLABORATOR",
    "active_lock_reason": null,
    "body": "**Is your feature request related to a problem? Please describe.**\r\nhttps://github.com/NVIDIA/spark-rapids/pull/8618 adds in a heuristic to do a sort based agg in some cases. As a part of my testing I found a number of cases (as small as 16 decimal sum aggregations) where the sort based aggregation was faster than the hash based version. I really would like to understand why this is happening and ideally once we know that design/extend the heuristic in #8618 to take advantage of this so that we can speed up large numbers of aggregations.\r\n\r\nA few things to note. \r\n\r\n  1.  #8618 only is doing this for partial aggregations. This could speed up all aggregations so if we see that it looks good we should apply it to all types of aggregations.\r\n  2. We don't necessarily have to sort all of the input data. We could sort each batch individually instead.  Would be good to see if there is a big improvement in having the full sort or not.\r\n  3. Spark already falls back to sort based aggs for a lot of cases. There are only a handful of aggs that are hash based https://github.com/rapidsai/cudf/blob/aed7174eae6c6eb38fbf186938df44f88787cf29/cpp/src/groupby/hash/groupby.cu#L83-L94 and even then the data being worked on has to be \"atomic\" really 64-bits or smaller.",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8620/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8620/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}