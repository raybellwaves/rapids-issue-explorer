{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9199",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9199/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9199/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9199/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/9199",
    "id": 1886208170,
    "node_id": "I_kwDOD7z77c5wbUCq",
    "number": 9199,
    "title": "[FEA] Implement `assert_gpu_and_cpu_row_counts_equal_with_capture`",
    "user": {
        "login": "andygrove",
        "id": 934084,
        "node_id": "MDQ6VXNlcjkzNDA4NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/934084?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andygrove",
        "html_url": "https://github.com/andygrove",
        "followers_url": "https://api.github.com/users/andygrove/followers",
        "following_url": "https://api.github.com/users/andygrove/following{/other_user}",
        "gists_url": "https://api.github.com/users/andygrove/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/andygrove/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/andygrove/subscriptions",
        "organizations_url": "https://api.github.com/users/andygrove/orgs",
        "repos_url": "https://api.github.com/users/andygrove/repos",
        "events_url": "https://api.github.com/users/andygrove/events{/privacy}",
        "received_events_url": "https://api.github.com/users/andygrove/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2094874947,
            "node_id": "MDU6TGFiZWwyMDk0ODc0OTQ3",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/test",
            "name": "test",
            "color": "60d6d4",
            "default": false,
            "description": "Only impacts tests"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2023-09-07T16:20:11Z",
    "updated_at": "2023-09-12T20:33:38Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "**Is your feature request related to a problem? Please describe.**\r\n\r\nThe function `assert_gpu_and_cpu_row_counts_equal` relies on `@allow_non_gpu` to determine which operators are allowed to fallback to CPU, and this is fine in most cases, but for the test `csv_test.py / test_csv_read_case_insensitivity` it is not sufficient because we have to allow certain operators to fallback to CPU when Spark initially scans the CSV file to infer the schema. This means that if the query being tested by `assert_gpu_and_cpu_row_counts_equal` also falls back for those operators (unintentionally) then we will not detect that as a regression.\r\n\r\n**Describe the solution you'd like**\r\nI would like to have a version of `assert_gpu_and_cpu_row_counts_equal` that captures the executed plan and verifies that the plan contains / does not contain specific operators, similar to how `assert_cpu_and_gpu_are_equal_collect_with_capture` works.\r\n\r\n**Describe alternatives you've considered**\r\n\r\n\r\n**Additional context**\r\nSee PR comment at https://github.com/NVIDIA/spark-rapids/pull/9146/files#r1317516247\r\n",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9199/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9199/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}