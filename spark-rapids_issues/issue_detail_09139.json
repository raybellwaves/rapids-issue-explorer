{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9139",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9139/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9139/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9139/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/9139",
    "id": 1873669106,
    "node_id": "I_kwDOD7z77c5vrevy",
    "number": 9139,
    "title": "[BUG] Not all operators are grabbing the semaphore when they need to",
    "user": {
        "login": "revans2",
        "id": 3441321,
        "node_id": "MDQ6VXNlcjM0NDEzMjE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3441321?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/revans2",
        "html_url": "https://github.com/revans2",
        "followers_url": "https://api.github.com/users/revans2/followers",
        "following_url": "https://api.github.com/users/revans2/following{/other_user}",
        "gists_url": "https://api.github.com/users/revans2/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/revans2/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/revans2/subscriptions",
        "organizations_url": "https://api.github.com/users/revans2/orgs",
        "repos_url": "https://api.github.com/users/revans2/repos",
        "events_url": "https://api.github.com/users/revans2/events{/privacy}",
        "received_events_url": "https://api.github.com/users/revans2/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2061735874,
            "node_id": "MDU6TGFiZWwyMDYxNzM1ODc0",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/bug",
            "name": "bug",
            "color": "d73a4a",
            "default": true,
            "description": "Something isn't working"
        },
        {
            "id": 4029093938,
            "node_id": "LA_kwDOD7z77c7wJxgy",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/reliability",
            "name": "reliability",
            "color": "2654AF",
            "default": false,
            "description": "Features to improve reliability or bugs that severly impact the reliability of the plugin"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2023-08-30T13:20:10Z",
    "updated_at": "2023-08-30T18:28:32Z",
    "closed_at": null,
    "author_association": "COLLABORATOR",
    "active_lock_reason": null,
    "body": "**Describe the bug**\r\nWhen debugging https://github.com/NVIDIA/spark-rapids/issues/9130 I found that join, at least in some cases, is not grabbing the GPU semaphore again before gathering another batch. I think this is likely also a problem with the retry iterator, which does not grab the semaphore before trying to process another batch.  In general any operation that can hold onto a batch in-between calls to next needs to grab the semaphore before processing the data. We have code in SpillableColumnarBatch to grab the semaphore before reading the data back to the GPU. But that is not enough. It does not happen when we acquire a batch that did not spill. And if all we have is a scalar value it does not happen there either.  It would be best to just grab it generally for any operator that is caching data before they touch anything on the GPU.\r\n\r\nJoin is special because we try to avoid grabbing the semaphore until the build side is ready to process on the GPU, so we need to be a little bit careful when fixing that code. But most others it should be very straight forward.",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9139/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9139/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}