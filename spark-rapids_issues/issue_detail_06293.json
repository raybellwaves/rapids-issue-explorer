{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/6293",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/6293/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/6293/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/6293/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/6293",
    "id": 1336138526,
    "node_id": "I_kwDOD7z77c5Po9se",
    "number": 6293,
    "title": "Tracking Exception Handling in Plugin Vs Spark",
    "user": {
        "login": "amahussein",
        "id": 50450311,
        "node_id": "MDQ6VXNlcjUwNDUwMzEx",
        "avatar_url": "https://avatars.githubusercontent.com/u/50450311?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/amahussein",
        "html_url": "https://github.com/amahussein",
        "followers_url": "https://api.github.com/users/amahussein/followers",
        "following_url": "https://api.github.com/users/amahussein/following{/other_user}",
        "gists_url": "https://api.github.com/users/amahussein/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/amahussein/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/amahussein/subscriptions",
        "organizations_url": "https://api.github.com/users/amahussein/orgs",
        "repos_url": "https://api.github.com/users/amahussein/repos",
        "events_url": "https://api.github.com/users/amahussein/events{/privacy}",
        "received_events_url": "https://api.github.com/users/amahussein/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2094874947,
            "node_id": "MDU6TGFiZWwyMDk0ODc0OTQ3",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/test",
            "name": "test",
            "color": "60d6d4",
            "default": false,
            "description": "Only impacts tests"
        },
        {
            "id": 2586576266,
            "node_id": "MDU6TGFiZWwyNTg2NTc2MjY2",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/task",
            "name": "task",
            "color": "65abf7",
            "default": false,
            "description": "Work required that improves the product but is not user facing"
        },
        {
            "id": 2792425851,
            "node_id": "MDU6TGFiZWwyNzkyNDI1ODUx",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/Spark%203.2+",
            "name": "Spark 3.2+",
            "color": "D05769",
            "default": false,
            "description": ""
        },
        {
            "id": 3759828653,
            "node_id": "LA_kwDOD7z77c7gGm6t",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/spark%203.3+",
            "name": "spark 3.3+",
            "color": "7D4C3A",
            "default": false,
            "description": ""
        },
        {
            "id": 4210237674,
            "node_id": "LA_kwDOD7z77c768yDq",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/Spark%203.4+",
            "name": "Spark 3.4+",
            "color": "d93f0b",
            "default": false,
            "description": "Spark 3.4+ issues"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2022-08-11T15:35:10Z",
    "updated_at": "2024-01-02T22:30:17Z",
    "closed_at": null,
    "author_association": "COLLABORATOR",
    "active_lock_reason": null,
    "body": "This is triggered by #6165\r\n\r\nWhile working on a fix for #6165, I saw some inconsistency on how the plugin handles errors.\r\nFor example, I found that Cast uses inconsistent ways to handle overflow:\r\n\r\n- `throw new ArithmeticException`\r\n- `throw RapidsErrorUtils`\r\n- `throw new IllegalStateException`\r\n- `throw QueryErrorUtils`\r\n\r\nThis inconsistency makes addressing a specific change more challenging because it requires looking grepping in the entire code/shims instead of just looking in one shim/class.\r\n\r\n\r\n**Suggested Solution**\r\n\r\nSimilar to previous issue #5196, I suggest to:\r\n\r\n- Create tables to be used as reference. Those table list the expected exceptions, exception messages, and what the GPU throws for each Spark version.\r\n\r\n| Case                             | example Query | spark-3.1           | Spark-3.2                | Spark-3.3                | Spark-3.4                               |\r\n|----------------------------------|---------------|---------------------|--------------------------|--------------------------|-----------------------------------------|\r\n| Cast Overflow Numeric to Numeric |  bla..bla      | ArithmeticException | SparkArithmeticException | SparkArithmeticException | SparkArithmeticException(CAST_OVERFLOW) |\r\n|                                  |               |                     |                          |                          |                                         |\r\n  \r\n- Add more tests to verify the exception throws by Cast operations. Currently, changing the exception type may not break any integration tests.\r\n\r\n\r\n**More Spark-3.4 commits that do not have equivalent RAPIDS issue**\r\n\r\n- [[SPARK-37945](https://issues.apache.org/jira/browse/SPARK-37945)][SQL][CORE] Use error classes in the execution errors of arithmetic ops (apache/spark@6c009180a7)\r\n- [[SPARK-39778](https://issues.apache.org/jira/browse/SPARK-39778)][SQL] Improve error classes and messages (apache/spark@add92d2860)\r\n- [[SPARK-40183](https://issues.apache.org/jira/browse/SPARK-40183)][SQL] Use error class NUMERIC_VALUE_OUT_OF_RANGE for overflow in decimal conversion https://github.com/apache/spark/commit/a12d121159\r\n- [[SPARK-40197](https://issues.apache.org/jira/browse/SPARK-40197)][SQL] Replace query plan with context for MULTI_VALUE_SUBQUERY_ERROR https://github.com/apache/spark/commit/e13fb3d6b2\r\n- [[SPARK-40260](https://issues.apache.org/jira/browse/SPARK-40260)][SQL] Use error classes in the compilation errors of GROUP BY a position https://github.com/apache/spark/commit/296fe49ec8\r\n- [[SPARK-40761](https://issues.apache.org/jira/browse/SPARK-40761)][SQL] Migrate type check failures of percentile expressions onto error classes https://github.com/apache/spark/commit/5c963e37fa\r\n- [[SPARK-40361](https://issues.apache.org/jira/browse/SPARK-40761)][SQL] Migrate arithmetic type check failures onto error classes https://github.com/apache/spark/commit/831bcb048d\r\n- [[SPARK-40358](https://issues.apache.org/jira/browse/SPARK-40358)][SQL] Migrate collection type check failures onto error classes https://github.com/apache/spark/commit/47d119dfc1\r\n- [[SPARK-40360](https://issues.apache.org/jira/browse/SPARK-40360)] ALREADY_EXISTS and NOT_FOUND exceptions (apache/spark@e7fbefe98f)\r\n- [[SPARK-40368](https://issues.apache.org/jira/browse/SPARK-40368)][SQL] Migrate Bloom Filter type check failures onto error classes (apache/spark@11bc5ce19e)\r\n- [[SPARK-40369](https://issues.apache.org/jira/browse/SPARK-40369)][CORE][SQL] Migrate the type check failures of calls via reflection onto error classes (apache/spark@2acfc1dbca)\r\n- [[SPARK-40615](https://issues.apache.org/jira/browse/SPARK-40615)][SQL] Check unsupported data types when decorrelating subqueries (apache/spark@480ca17dd3)\r\n- [[SPARK-40663](https://issues.apache.org/jira/browse/SPARK-40663)][SQL] Migrate execution errors onto error classes: _LEGACY_ERROR_TEMP_2226-2250 (apache/spark@e65dd7848c)\r\n- [[SPARK-40750](https://issues.apache.org/jira/browse/SPARK-40750)][SQL] Migrate type check failures of math expressions onto error classes (apache/spark@9d2757c6c4)\r\n- [[SPARK-45473](https://issues.apache.org/jira/browse/SPARK-45473)]Incorrect error message for RoundBase (apache/spark@d33644a9f8c)\r\n- [[SPARK-40751](https://issues.apache.org/jira/browse/SPARK-40751)][SQL] Migrate type check failures of high order functions onto error classes (apache/spark@74668e2bf1)\r\n- [[SPARK-40752](https://issues.apache.org/jira/browse/SPARK-40752)][SQL] Migrate type check failures of misc expressions on to error classes (apache/spark@2cc4e3f19b)\r\n- [[SPARK-40756](https://issues.apache.org/jira/browse/SPARK-40756)][SQL] Migrate type check failures of string expressions onto error classes (apache/spark@f81c26579e)\r\n- [[SPARK-40759](https://issues.apache.org/jira/browse/SPARK-40759)][SQL] Migrate type check failures of time window onto error classes (apache/spark@d310d9b569)\r\n- [[SPARK-40760](https://issues.apache.org/jira/browse/SPARK-40760)][SQL] Migrate type check failures of interval expressions onto error classes (apache/spark@625f76dae0)\r\n- [[SPARK-40768](https://issues.apache.org/jira/browse/SPARK-40768)][SQL] Migrate type check failures of bloom_filter_agg() onto error classes (apache/spark@11cce7e733)\r\n- [[SPARK-40856](https://issues.apache.org/jira/browse/SPARK-40856)][SQL] Update the error template of WRONG_NUM_PARAMS (apache/spark@dece380d45)\r\n- [[SPARK-40910](https://issues.apache.org/jira/browse/SPARK-40910)][SQL] Replace UnsupportedOperationException with SparkUnsupportedOperationException (apache/spark@e0f44103bc)\r\n\r\n\r\n**Opened issues related to error handling**\r\n\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/5806\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/5807\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/5826\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/5152\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/5908\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/6262\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/6199\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/6185\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/6182\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/6076\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/6039\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/6014\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/6012\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/6327\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/6381\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/6383\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/6384\r\n- [ ] https://github.com/NVIDIA/spark-rapids/issues/6671",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/6293/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/6293/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}