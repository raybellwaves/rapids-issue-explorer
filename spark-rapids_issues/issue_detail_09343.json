{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9343",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9343/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9343/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9343/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/9343",
    "id": 1919427248,
    "node_id": "I_kwDOD7z77c5yaCKw",
    "number": 9343,
    "title": "[BUG] Match JDK behavior when formatting double/float",
    "user": {
        "login": "revans2",
        "id": 3441321,
        "node_id": "MDQ6VXNlcjM0NDEzMjE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3441321?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/revans2",
        "html_url": "https://github.com/revans2",
        "followers_url": "https://api.github.com/users/revans2/followers",
        "following_url": "https://api.github.com/users/revans2/following{/other_user}",
        "gists_url": "https://api.github.com/users/revans2/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/revans2/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/revans2/subscriptions",
        "organizations_url": "https://api.github.com/users/revans2/orgs",
        "repos_url": "https://api.github.com/users/revans2/repos",
        "events_url": "https://api.github.com/users/revans2/events{/privacy}",
        "received_events_url": "https://api.github.com/users/revans2/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2061735874,
            "node_id": "MDU6TGFiZWwyMDYxNzM1ODc0",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/bug",
            "name": "bug",
            "color": "d73a4a",
            "default": true,
            "description": "Something isn't working"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2023-09-29T14:58:56Z",
    "updated_at": "2023-10-03T21:25:34Z",
    "closed_at": null,
    "author_association": "COLLABORATOR",
    "active_lock_reason": null,
    "body": "**Describe the bug**\r\nIn java the behavior of format_number changed between JDK7 and JDK8\r\n\r\nhttps://bugs.openjdk.org/browse/JDK-8029896\r\n\r\nMany people thought it was a bug because the printed results don't look correct for HALF_EVEN rounding, but it is doing the right thing when just looking at the bits to decide if rounding should happen or not. Note that this is different behavior from doing a bround and casting the result to a string.  Our current version for many of these numbers does not produce the same result as Spark/Java does and we should look into fixing it, especially if we are going to write a custom kernel for format_number anyways.\r\n\r\n**Steps/Code to reproduce bug**\r\nHere are a few examples of failures. In these cases `i/id` produces `div_num` and then `format_number` is used to produce `fn`. `rounded` is the output of `bround` to the same number of decimal places.\r\n\r\n1 decimal place\r\n```\r\n+---+-------+---+-------+-----+----------+                                      \r\n|id |div_num|fn |rounded|count|_in_column|\r\n+---+-------+---+-------+-----+----------+\r\n|20 |0.05   |0.1|0.0    |1    |CPU       |\r\n|20 |0.05   |0.0|0.0    |1    |GPU       |\r\n+---+-------+---+-------+-----+----------+\r\n```\r\n\r\n2 decimal places\r\n```\r\n+---+-------+----+-------+-----+----------+                                     \r\n|id |div_num|fn  |rounded|count|_in_column|\r\n+---+-------+----+-------+-----+----------+\r\n|40 |0.025  |0.03|0.02   |1    |CPU       |\r\n|40 |0.025  |0.02|0.02   |1    |GPU       |\r\n|200|0.005  |0.01|0.0    |1    |CPU       |\r\n|200|0.005  |0.00|0.0    |1    |GPU       |\r\n+---+-------+----+-------+-----+----------+\r\n```\r\n\r\n3 decimal places\r\n```\r\n+---+-------+-----+-------+-----+----------+                                    \r\n|id |div_num|fn   |rounded|count|_in_column|\r\n+---+-------+-----+-------+-----+----------+\r\n|80 |0.0125 |0.013|0.012  |1    |CPU       |\r\n|80 |0.0125 |0.012|0.012  |1    |GPU       |\r\n|400|0.0025 |0.003|0.002  |1    |CPU       |\r\n|400|0.0025 |0.002|0.002  |1    |GPU       |\r\n+---+-------+-----+-------+-----+----------+\r\n```\r\n\r\nThis is in addition to the normal issues with `format_number`.\r\n\r\nhttps://github.com/NVIDIA/spark-rapids/issues/9173\r\n\r\nWe probably want to test a lot more values that have a 5 at the digit just after the one we are rounding to, so that we can truly verify that they are all correct.",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9343/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9343/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}