{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9582",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9582/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9582/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9582/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/9582",
    "id": 1969441829,
    "node_id": "I_kwDOD7z77c51Y0wl",
    "number": 9582,
    "title": "[BUG] GpuSortRetrySuite failed core dump",
    "user": {
        "login": "pxLi",
        "id": 8086184,
        "node_id": "MDQ6VXNlcjgwODYxODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8086184?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pxLi",
        "html_url": "https://github.com/pxLi",
        "followers_url": "https://api.github.com/users/pxLi/followers",
        "following_url": "https://api.github.com/users/pxLi/following{/other_user}",
        "gists_url": "https://api.github.com/users/pxLi/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/pxLi/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/pxLi/subscriptions",
        "organizations_url": "https://api.github.com/users/pxLi/orgs",
        "repos_url": "https://api.github.com/users/pxLi/repos",
        "events_url": "https://api.github.com/users/pxLi/events{/privacy}",
        "received_events_url": "https://api.github.com/users/pxLi/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2061735874,
            "node_id": "MDU6TGFiZWwyMDYxNzM1ODc0",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/bug",
            "name": "bug",
            "color": "d73a4a",
            "default": true,
            "description": "Something isn't working"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [
        {
            "login": "revans2",
            "id": 3441321,
            "node_id": "MDQ6VXNlcjM0NDEzMjE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3441321?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/revans2",
            "html_url": "https://github.com/revans2",
            "followers_url": "https://api.github.com/users/revans2/followers",
            "following_url": "https://api.github.com/users/revans2/following{/other_user}",
            "gists_url": "https://api.github.com/users/revans2/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/revans2/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/revans2/subscriptions",
            "organizations_url": "https://api.github.com/users/revans2/orgs",
            "repos_url": "https://api.github.com/users/revans2/repos",
            "events_url": "https://api.github.com/users/revans2/events{/privacy}",
            "received_events_url": "https://api.github.com/users/revans2/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 6,
    "created_at": "2023-10-31T00:46:29Z",
    "updated_at": "2023-11-01T05:24:12Z",
    "closed_at": null,
    "author_association": "COLLABORATOR",
    "active_lock_reason": null,
    "body": "**Describe the bug**\r\nLooks like this is not always reproducible, we firstly found it in premerge run \r\nhttps://github.com/NVIDIA/spark-rapids/pull/9576#issuecomment-1786255294\r\n\r\nfailed CI instance A30 + 32 cores cpu\r\n\r\n```\r\n[2023-10-30T21:16:58.548Z] GpuSortRetrySuite:\r\n[2023-10-30T21:16:58.549Z] - GPU out-of-core sort without OOM failures *** FAILED ***\r\n[2023-10-30T21:16:58.549Z]   java.lang.AssertionError: assertion failed\r\n[2023-10-30T21:16:58.549Z]   at scala.Predef$.assert(Predef.scala:264)\r\n[2023-10-30T21:16:58.549Z]   at com.nvidia.spark.rapids.GpuSorter.$anonfun$mergeSortAndCloseWithRetry$1(SortUtils.scala:248)\r\n[2023-10-30T21:16:58.549Z]   at com.nvidia.spark.rapids.GpuSorter.$anonfun$mergeSortAndCloseWithRetry$1$adapted(SortUtils.scala:247)\r\n[2023-10-30T21:16:58.549Z]   at com.nvidia.spark.rapids.ArmScalaSpecificImpl.closeOnExcept(ArmScalaSpecificImpl.scala:40)\r\n[2023-10-30T21:16:58.549Z]   at com.nvidia.spark.rapids.ArmScalaSpecificImpl.closeOnExcept$(ArmScalaSpecificImpl.scala:37)\r\n[2023-10-30T21:16:58.549Z]   at com.nvidia.spark.rapids.Arm$.closeOnExcept(Arm.scala:24)\r\n[2023-10-30T21:16:58.549Z]   at com.nvidia.spark.rapids.GpuSorter.mergeSortAndCloseWithRetry(SortUtils.scala:247)\r\n[2023-10-30T21:16:58.549Z]   at com.nvidia.spark.rapids.GpuOutOfCoreSortIterator.mergeSortEnoughToOutput(GpuSortExec.scala:463)\r\n[2023-10-30T21:16:58.549Z]   at com.nvidia.spark.rapids.GpuOutOfCoreSortIterator.$anonfun$next$3(GpuSortExec.scala:573)\r\n[2023-10-30T21:16:58.549Z]   at com.nvidia.spark.rapids.Arm$.withResource(Arm.scala:29)\r\n[2023-10-30T21:16:58.549Z]   ...\r\n[2023-10-30T21:16:59.477Z] #\r\n[2023-10-30T21:16:59.478Z] # A fatal error has been detected by the Java Runtime Environment:\r\n[2023-10-30T21:16:59.478Z] #\r\n[2023-10-30T21:16:59.478Z] #  SIGSEGV (0xb) at pc=0x00007fc25d7e8ab0, pid=2625, tid=0x00007fc3be149700\r\n[2023-10-30T21:16:59.478Z] #\r\n[2023-10-30T21:16:59.478Z] # JRE version: OpenJDK Runtime Environment (8.0_382-b05) (build 1.8.0_382-8u382-ga-1~20.04.1-b05)\r\n[2023-10-30T21:16:59.478Z] # Java VM: OpenJDK 64-Bit Server VM (25.382-b05 mixed mode linux-amd64 compressed oops)\r\n[2023-10-30T21:16:59.479Z] # Problematic frame:\r\n[2023-10-30T21:16:59.479Z] # C  0x00007fc25d7e8ab0\r\n[2023-10-30T21:16:59.479Z] #\r\n[2023-10-30T21:16:59.479Z] # Core dump written. Default location: /home/jenkins/agent/workspace/jenkins-rapids_premerge-github-8240-scala-213/scala2.13/tests/core or core.2625\r\n[2023-10-30T21:16:59.479Z] #\r\n[2023-10-30T21:16:59.479Z] # An error report file with more information is saved as:\r\n[2023-10-30T21:16:59.479Z] # /home/jenkins/agent/workspace/jenkins-rapids_premerge-github-8240-scala-213/scala2.13/tests/hs_err_pid2625.log\r\n[2023-10-30T21:16:59.479Z] #\r\n[2023-10-30T21:16:59.479Z] # If you would like to submit a bug report, please visit:\r\n[2023-10-30T21:16:59.479Z] #   http://bugreport.java.com/bugreport/crash.jsp\r\n[2023-10-30T21:16:59.479Z] # The crash happened outside the Java Virtual Machine in native code.\r\n[2023-10-30T21:16:59.479Z] # See problematic frame for where to report the bug.\r\n```\r\n\r\nattached core dump log: \r\n[hs_err_pid2625.log](https://github.com/NVIDIA/spark-rapids/files/13210857/hs_err_pid2625.log)\r\n```\r\n[2023-10-30T21:17:19.369Z] ---------------  T H R E A D  ---------------\r\n[2023-10-30T21:17:19.369Z] \r\n[2023-10-30T21:17:19.369Z] Current thread (0x00007fc3b8016000):  JavaThread \"ScalaTest-main-running-GpuSortRetrySuite\" [_thread_in_native, id=2628, stack(0x00007fc3bdd4a000,0x00007fc3be14a000)]\r\n[2023-10-30T21:17:19.369Z] \r\n[2023-10-30T21:17:19.369Z] siginfo: si_signo: 11 (SIGSEGV), si_code: 2 (SEGV_ACCERR), si_addr: 0x00007fc25d7e8ab0\r\n[2023-10-30T21:17:19.369Z] \r\n[2023-10-30T21:17:19.369Z] Registers:\r\n[2023-10-30T21:17:19.369Z] RAX=0x00007fc25ed23040, RBX=0x00007fc37238d1d0, RCX=0x0000000000000002, RDX=0x00000000000001c0\r\n[2023-10-30T21:17:19.369Z] RSP=0x00007fc3be1458b8, RBP=0x00007fc3b8016260, RSI=0x00007fbeee400200, RDI=0x00007fc25ed29310\r\n[2023-10-30T21:17:19.369Z] R8 =0x000055ea34cfd190, R9 =0x000055ea34cfd190, R10=0x00007fc3a9017dbb, R11=0x00007fc3beebfb00\r\n[2023-10-30T21:17:19.369Z] R12=0x00007fc25ec55aa0, R13=0x00007fc37238d1c8, R14=0x00007fc3be1459b0, R15=0x00007fc3b8016000\r\n[2023-10-30T21:17:19.370Z] RIP=0x00007fc25d7e8ab0, EFLAGS=0x0000000000010206, CSGSFS=0x002b000000000033, ERR=0x0000000000000015\r\n[2023-10-30T21:17:19.370Z]   TRAPNO=0x000000000000000e\r\n[2023-10-30T21:17:19.370Z] \r\n[2023-10-30T21:17:19.370Z] Top of Stack: (sp=0x00007fc3be1458b8)\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be1458b8:   00007fc29516e53c 0000000778185660\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be1458c8:   0000000500000000 0000000778185580\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be1458d8:   00007fc3b8016000 00007fc3b800f890\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be1458e8:   714ffb348b80ec00 00007fc3b8016000\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be1458f8:   00007fc37238d1d0 00007fc3be145988\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145908:   0000000000000000 00007fc37238d1c8\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145918:   00007fc3be1459b0 00007fc3b8016000\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145928:   00007fc3a9017de7 00007fc3bf1b6518\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145938:   714ffb348b80ec00 0000000000000000\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145948:   00007fc3be145948 0000000000000000\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145958:   00007fc3be1459b0 00007fc37238e930\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145968:   0000000000000000 00007fc37238d1d0\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145978:   0000000000000000 00007fc3be1459a8\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145988:   00007fc3be145a08 00007fc3a9007ffd\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145998:   00000006c11d3108 00007fc3a9011a58\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be1459a8:   00007fc25ec55aa0 00000006c4a808b0\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be1459b8:   00007fc3aa231e7c 0000000778165588\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be1459c8:   00007fc3be1459b8 00007fc3713161a6\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be1459d8:   00007fc3be145a30 00007fc3987a4658\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be1459e8:   0000000000000000 00007fc371316228\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be1459f8:   00007fc3be1459a8 00007fc3be145a40\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145a08:   00000000d81eaad0 00007fc3ad036420\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145a18:   0000000000000000 00000006c4a808b0\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145a28:   714ffb3400000000 0000000778165588\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145a38:   00007fc3ad036420 000000220000003d\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145a48:   ef02cab1d81ea889 0000000778165550\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145a58:   00000006c0f55680 0000000778165588\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145a68:   0000000778165588 00000006c0f54448\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145a78:   00000007781655b0 0000000778185148\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145a88:   0000000778185168 0000002fd8482d14\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145a98:   a0644a0d418c38b6 00000006c0020448\r\n[2023-10-30T21:17:19.370Z] 0x00007fc3be145aa8:   00000007c0000f28 000000077817b1c0 \r\n[2023-10-30T21:17:19.370Z] \r\n[2023-10-30T21:17:19.370Z] Instructions: (pc=0x00007fc25d7e8ab0)\r\n[2023-10-30T21:17:19.370Z] 0x00007fc25d7e8a90:   00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\r\n[2023-10-30T21:17:19.370Z] 0x00007fc25d7e8aa0:   00 00 00 00 00 00 00 00 35 00 00 00 00 00 00 00\r\n[2023-10-30T21:17:19.370Z] 0x00007fc25d7e8ab0:   40 2c c6 5e c2 7f 00 00 d0 08 00 b8 c3 7f 00 00\r\n[2023-10-30T21:17:19.370Z] 0x00007fc25d7e8ac0:   00 00 00 00 00 00 00 00 58 2c c6 5e c2 7f 00 00 \r\n[2023-10-30T21:17:19.370Z] \r\n[2023-10-30T21:17:19.370Z] Register to memory mapping:\r\n[2023-10-30T21:17:19.370Z] \r\n[2023-10-30T21:17:19.370Z] RAX=0x00007fc25ed23040 is an unknown value\r\n[2023-10-30T21:17:19.370Z] RBX={method} {0x00007fc37238d1d0} 'freeDeviceBuffer' '(J)V' in 'ai/rapids/cudf/Rmm'\r\n[2023-10-30T21:17:19.370Z] RCX=0x0000000000000002 is an unknown value\r\n[2023-10-30T21:17:19.370Z] RDX=0x00000000000001c0 is an unknown value\r\n[2023-10-30T21:17:19.370Z] RSP=0x00007fc3be1458b8 is pointing into the stack for thread: 0x00007fc3b8016000\r\n[2023-10-30T21:17:19.370Z] RBP=0x00007fc3b8016260 is an unknown value\r\n[2023-10-30T21:17:19.370Z] RSI=0x00007fbeee400200 is an unknown value\r\n[2023-10-30T21:17:19.370Z] RDI=0x00007fc25ed29310 is an unknown value\r\n[2023-10-30T21:17:19.370Z] R8 =0x000055ea34cfd190 is an unknown value\r\n[2023-10-30T21:17:19.370Z] R9 =0x000055ea34cfd190 is an unknown value\r\n[2023-10-30T21:17:19.370Z] R10=0x00007fc3a9017dbb is at code_begin+859 in an Interpreter codelet\r\n[2023-10-30T21:17:19.370Z] method entry point (kind = native)  [0x00007fc3a9017a60, 0x00007fc3a9018400]  2464 bytes\r\n[2023-10-30T21:17:19.370Z] R11=0x00007fc3beebfb00: <offset 0xa29b00> in /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/amd64/server/libjvm.so at 0x00007fc3be496000\r\n[2023-10-30T21:17:19.370Z] R12=0x00007fc25ec55aa0 is an unknown value\r\n[2023-10-30T21:17:19.370Z] R13=0x00007fc37238d1c8 is pointing into metadata\r\n[2023-10-30T21:17:19.370Z] R14=0x00007fc3be1459b0 is pointing into the stack for thread: 0x00007fc3b8016000\r\n[2023-10-30T21:17:19.370Z] R15=0x00007fc3b8016000 is a thread\r\n```\r\n\r\n\r\n**Steps/Code to reproduce bug**\r\nPlease provide a list of steps or a code sample to reproduce the issue.\r\nAvoid posting private or sensitive data.\r\n\r\n**Expected behavior**\r\nPass the test constantly\r\n\r\n**Environment details (please complete the following information)**\r\n - Environment location: [Standalone, YARN, Kubernetes, Cloud(specify cloud provider)]\r\n - Spark configuration settings related to the issue\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n",
    "closed_by": {
        "login": "pxLi",
        "id": 8086184,
        "node_id": "MDQ6VXNlcjgwODYxODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8086184?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pxLi",
        "html_url": "https://github.com/pxLi",
        "followers_url": "https://api.github.com/users/pxLi/followers",
        "following_url": "https://api.github.com/users/pxLi/following{/other_user}",
        "gists_url": "https://api.github.com/users/pxLi/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/pxLi/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/pxLi/subscriptions",
        "organizations_url": "https://api.github.com/users/pxLi/orgs",
        "repos_url": "https://api.github.com/users/pxLi/repos",
        "events_url": "https://api.github.com/users/pxLi/events{/privacy}",
        "received_events_url": "https://api.github.com/users/pxLi/received_events",
        "type": "User",
        "site_admin": false
    },
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9582/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9582/timeline",
    "performed_via_github_app": null,
    "state_reason": "reopened"
}