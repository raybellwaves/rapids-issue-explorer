{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9787",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9787/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9787/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9787/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/9787",
    "id": 2001080175,
    "node_id": "I_kwDOD7z77c53Rg9v",
    "number": 9787,
    "title": "Use JUnitRunner to run ScalaTests in parallel ",
    "user": {
        "login": "gerashegalov",
        "id": 3187938,
        "node_id": "MDQ6VXNlcjMxODc5Mzg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3187938?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gerashegalov",
        "html_url": "https://github.com/gerashegalov",
        "followers_url": "https://api.github.com/users/gerashegalov/followers",
        "following_url": "https://api.github.com/users/gerashegalov/following{/other_user}",
        "gists_url": "https://api.github.com/users/gerashegalov/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/gerashegalov/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gerashegalov/subscriptions",
        "organizations_url": "https://api.github.com/users/gerashegalov/orgs",
        "repos_url": "https://api.github.com/users/gerashegalov/repos",
        "events_url": "https://api.github.com/users/gerashegalov/events{/privacy}",
        "received_events_url": "https://api.github.com/users/gerashegalov/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2094874947,
            "node_id": "MDU6TGFiZWwyMDk0ODc0OTQ3",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/test",
            "name": "test",
            "color": "60d6d4",
            "default": false,
            "description": "Only impacts tests"
        },
        {
            "id": 2137414845,
            "node_id": "MDU6TGFiZWwyMTM3NDE0ODQ1",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/build",
            "name": "build",
            "color": "0052cc",
            "default": false,
            "description": "Related to CI / CD or cleanly building"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "yinqingh",
        "id": 22501635,
        "node_id": "MDQ6VXNlcjIyNTAxNjM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/22501635?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/yinqingh",
        "html_url": "https://github.com/yinqingh",
        "followers_url": "https://api.github.com/users/yinqingh/followers",
        "following_url": "https://api.github.com/users/yinqingh/following{/other_user}",
        "gists_url": "https://api.github.com/users/yinqingh/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/yinqingh/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/yinqingh/subscriptions",
        "organizations_url": "https://api.github.com/users/yinqingh/orgs",
        "repos_url": "https://api.github.com/users/yinqingh/repos",
        "events_url": "https://api.github.com/users/yinqingh/events{/privacy}",
        "received_events_url": "https://api.github.com/users/yinqingh/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "yinqingh",
            "id": 22501635,
            "node_id": "MDQ6VXNlcjIyNTAxNjM1",
            "avatar_url": "https://avatars.githubusercontent.com/u/22501635?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/yinqingh",
            "html_url": "https://github.com/yinqingh",
            "followers_url": "https://api.github.com/users/yinqingh/followers",
            "following_url": "https://api.github.com/users/yinqingh/following{/other_user}",
            "gists_url": "https://api.github.com/users/yinqingh/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/yinqingh/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/yinqingh/subscriptions",
            "organizations_url": "https://api.github.com/users/yinqingh/orgs",
            "repos_url": "https://api.github.com/users/yinqingh/repos",
            "events_url": "https://api.github.com/users/yinqingh/events{/privacy}",
            "received_events_url": "https://api.github.com/users/yinqingh/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 5,
    "created_at": "2023-11-19T23:00:12Z",
    "updated_at": "2024-02-07T05:38:10Z",
    "closed_at": null,
    "author_association": "COLLABORATOR",
    "active_lock_reason": null,
    "body": "SparkQueryCompareTestSuite-based tests cannot be run in with `-Dparallel` using the standard ScalaTest runner because it only supports intra-JVM parallelism,  and the tests would clobber each other's Spark sessions.  \r\n\r\nWith the surefire plugin it is possible to run multiple tests across forked JVMs and if the thread count per JVM is one the SparkQueryCompareTestSuite-based test will work correctly. \r\n\r\nThere are a couple of ways to run ScalaTests in the JUnit framework. the least amount of change is by annotating Suite classes with\r\n`@org.junit.runner.RunWith(classOf[org.scalatestplus.junit.JUnitRunner])` (easy to script / bulk edit in IDE)\r\n\r\nWith the prototype [branch](https://github.com/NVIDIA/spark-rapids/compare/branch-23.12...gerashegalov:junitRunner?expand=1) that does not take care of many things like automatically calculating memory as we do with xdist, setting up logging and reporting right, etc, we can see a positive effect\r\n\r\n`branch-23.12` using ScalaTest runner\r\n```bash\r\n$ mvn package -pl tests -am -Dmaven.scalastyle.skip -Dmaven.scaladoc.skip -Dbuildver=330 \\\r\n      -Dsuffixes='.*(Orc|Parquet).*Suite.*'\r\nTests: succeeded 130, failed 0, canceled 24, ignored 9, pending 0\r\n[INFO] RAPIDS Accelerator for Apache Spark Tests .......... SUCCESS [07:43 min]\r\n```\r\n\r\njunitRunner  branch with forkCount=2 with the same set of tests\r\n```bash\r\n$ mvn package -pl tests -am -Dmaven.scalastyle.skip -Dmaven.scaladoc.skip -Dbuildver=330 -Dsuffixes=NONE \\\r\n      -Dsurefire.includes='%regex[.*(Orc|Parquet).*Suite.*]'\r\nTests run: 130, Failures: 0, Errors: 0, Skipped: 0\r\n[INFO] RAPIDS Accelerator for Apache Spark Tests .......... SUCCESS [04:32 min]\r\n```\r\n\r\n\r\n\r\n\r\n",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9787/reactions",
        "total_count": 2,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 1,
        "confused": 0,
        "heart": 1,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/9787/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}