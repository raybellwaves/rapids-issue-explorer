{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5303",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5303/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5303/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5303/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/5303",
    "id": 1213587646,
    "node_id": "I_kwDOD7z77c5IVeC-",
    "number": 5303,
    "title": "[BUG] OOM in Power Run when UCX is on with mono-plugin jar",
    "user": {
        "login": "wjxiz1992",
        "id": 20476954,
        "node_id": "MDQ6VXNlcjIwNDc2OTU0",
        "avatar_url": "https://avatars.githubusercontent.com/u/20476954?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/wjxiz1992",
        "html_url": "https://github.com/wjxiz1992",
        "followers_url": "https://api.github.com/users/wjxiz1992/followers",
        "following_url": "https://api.github.com/users/wjxiz1992/following{/other_user}",
        "gists_url": "https://api.github.com/users/wjxiz1992/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/wjxiz1992/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/wjxiz1992/subscriptions",
        "organizations_url": "https://api.github.com/users/wjxiz1992/orgs",
        "repos_url": "https://api.github.com/users/wjxiz1992/repos",
        "events_url": "https://api.github.com/users/wjxiz1992/events{/privacy}",
        "received_events_url": "https://api.github.com/users/wjxiz1992/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2061735874,
            "node_id": "MDU6TGFiZWwyMDYxNzM1ODc0",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/bug",
            "name": "bug",
            "color": "d73a4a",
            "default": true,
            "description": "Something isn't working"
        },
        {
            "id": 2096543664,
            "node_id": "MDU6TGFiZWwyMDk2NTQzNjY0",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/shuffle",
            "name": "shuffle",
            "color": "67fc73",
            "default": false,
            "description": "things that impact the shuffle plugin"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "abellina",
        "id": 1901059,
        "node_id": "MDQ6VXNlcjE5MDEwNTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1901059?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/abellina",
        "html_url": "https://github.com/abellina",
        "followers_url": "https://api.github.com/users/abellina/followers",
        "following_url": "https://api.github.com/users/abellina/following{/other_user}",
        "gists_url": "https://api.github.com/users/abellina/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/abellina/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/abellina/subscriptions",
        "organizations_url": "https://api.github.com/users/abellina/orgs",
        "repos_url": "https://api.github.com/users/abellina/repos",
        "events_url": "https://api.github.com/users/abellina/events{/privacy}",
        "received_events_url": "https://api.github.com/users/abellina/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "abellina",
            "id": 1901059,
            "node_id": "MDQ6VXNlcjE5MDEwNTk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1901059?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/abellina",
            "html_url": "https://github.com/abellina",
            "followers_url": "https://api.github.com/users/abellina/followers",
            "following_url": "https://api.github.com/users/abellina/following{/other_user}",
            "gists_url": "https://api.github.com/users/abellina/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/abellina/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/abellina/subscriptions",
            "organizations_url": "https://api.github.com/users/abellina/orgs",
            "repos_url": "https://api.github.com/users/abellina/repos",
            "events_url": "https://api.github.com/users/abellina/events{/privacy}",
            "received_events_url": "https://api.github.com/users/abellina/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 6,
    "created_at": "2022-04-24T08:36:39Z",
    "updated_at": "2022-07-12T20:36:52Z",
    "closed_at": null,
    "author_association": "COLLABORATOR",
    "active_lock_reason": null,
    "body": "**Describe the bug**\r\nStart from 04/21, NDS Power Run with UCX on started to fail in our daily CI job in spark2a with the following error message in executors\r\n```\r\ndispatcher-Executor 22/04/24 07:24:20:786 ERROR RapidsExecutorPlugin: Exception in the executor plugin, shutting down!\r\nai.rapids.cudf.CudaException: out of memory\r\n        at ai.rapids.cudf.Cuda.freeZero(Native Method)\r\n        at com.nvidia.spark.rapids.GpuDeviceManager$.setGpuDeviceAndAcquire(GpuDeviceManager.scala:99)\r\n        at com.nvidia.spark.rapids.GpuDeviceManager$.$anonfun$initializeGpu$1(GpuDeviceManager.scala:125)\r\n        at scala.runtime.java8.JFunction1$mcII$sp.apply(JFunction1$mcII$sp.java:23)\r\n        at scala.Option.map(Option.scala:230)\r\n        at com.nvidia.spark.rapids.GpuDeviceManager$.initializeGpu(GpuDeviceManager.scala:125)\r\n        at com.nvidia.spark.rapids.GpuDeviceManager$.initializeGpuAndMemory(GpuDeviceManager.scala:136)\r\n        at com.nvidia.spark.rapids.RapidsExecutorPlugin.init(Plugin.scala:232)\r\n        at org.apache.spark.internal.plugin.ExecutorPluginContainer.$anonfun$executorPlugins$1(PluginContainer.scala:125)\r\n        at scala.collection.TraversableLike.$anonfun$flatMap$1(TraversableLike.scala:245)\r\n        at scala.collection.mutable.ResizableArray.foreach(ResizableArray.scala:62)\r\n        at scala.collection.mutable.ResizableArray.foreach$(ResizableArray.scala:55)\r\n        at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:49)\r\n        at scala.collection.TraversableLike.flatMap(TraversableLike.scala:245)\r\n        at scala.collection.TraversableLike.flatMap$(TraversableLike.scala:242)\r\n        at scala.collection.AbstractTraversable.flatMap(Traversable.scala:108)\r\n        at org.apache.spark.internal.plugin.ExecutorPluginContainer.<init>(PluginContainer.scala:113)\r\n        at org.apache.spark.internal.plugin.PluginContainer$.apply(PluginContainer.scala:211)\r\n        at org.apache.spark.internal.plugin.PluginContainer$.apply(PluginContainer.scala:199)\r\n        at org.apache.spark.executor.Executor.$anonfun$plugins$1(Executor.scala:253)\r\n        at org.apache.spark.util.Utils$.withContextClassLoader(Utils.scala:222)\r\n        at org.apache.spark.executor.Executor.<init>(Executor.scala:253)\r\n        at org.apache.spark.executor.CoarseGrainedExecutorBackend$$anonfun$receive$1.applyOrElse(CoarseGrainedExecutorBackend.scala:159)\r\n        at org.apache.spark.rpc.netty.Inbox.$anonfun$process$1(Inbox.scala:115)\r\n        at org.apache.spark.rpc.netty.Inbox.safelyCall(Inbox.scala:213)\r\n        at org.apache.spark.rpc.netty.Inbox.process(Inbox.scala:100)\r\n        at org.apache.spark.rpc.netty.MessageLoop.org$apache$spark$rpc$netty$MessageLoop$$receiveLoop(MessageLoop.scala:75)\r\n        at org.apache.spark.rpc.netty.MessageLoop$$anon$1.run(MessageLoop.scala:41)\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n        at java.lang.Thread.run(Thread.java:748)\r\n\r\n```\r\n**Steps/Code to reproduce bug**\r\nRun NDS power with our latest NDS2.0 script:\r\n```\r\n./spark-submit-template power_run_gpu.template \\\r\nnds_power.py \\\r\nnds2.0/parquet_sf3k_decimal \\\r\nnds2.0/query_streams_sf3k/query_1.sql \\\r\ntime.csv \\\r\n```\r\n\r\n\r\n\r\n**Environment details (please complete the following information)**\r\n - Environment location: Standalone\r\n\r\n**Additional context**\r\nThe error doesn't happen to specific query in different runs but happens to non-deterministic query. \r\nPower Run with the jar right before our mono-plugin jar change is good. the jars are : cudf-22.06.0-20220417.022449-22.jar and rapids-4-spark_2.12-22.06.0-20220417.093742-14.jar.\r\n\r\nnon-UCX run is always good till now.\r\n",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5303/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5303/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}