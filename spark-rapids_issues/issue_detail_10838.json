{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10838",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10838/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10838/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10838/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/10838",
    "id": 2303881372,
    "node_id": "I_kwDOD7z77c6JUnCc",
    "number": 10838,
    "title": "Improve convertToGpu diagnostics and unbloat GpuOverrides ",
    "user": {
        "login": "gerashegalov",
        "id": 3187938,
        "node_id": "MDQ6VXNlcjMxODc5Mzg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3187938?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gerashegalov",
        "html_url": "https://github.com/gerashegalov",
        "followers_url": "https://api.github.com/users/gerashegalov/followers",
        "following_url": "https://api.github.com/users/gerashegalov/following{/other_user}",
        "gists_url": "https://api.github.com/users/gerashegalov/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/gerashegalov/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gerashegalov/subscriptions",
        "organizations_url": "https://api.github.com/users/gerashegalov/orgs",
        "repos_url": "https://api.github.com/users/gerashegalov/repos",
        "events_url": "https://api.github.com/users/gerashegalov/events{/privacy}",
        "received_events_url": "https://api.github.com/users/gerashegalov/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 3002001655,
            "node_id": "MDU6TGFiZWwzMDAyMDAxNjU1",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/ease%20of%20use",
            "name": "ease of use",
            "color": "5500FD",
            "default": false,
            "description": "Makes the product simpler to use or configure"
        },
        {
            "id": 3444490915,
            "node_id": "LA_kwDOD7z77c7NTsKj",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/tech%20debt",
            "name": "tech debt",
            "color": "0052cc",
            "default": false,
            "description": ""
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2024-05-18T06:28:23Z",
    "updated_at": "2024-05-21T21:01:35Z",
    "closed_at": null,
    "author_association": "COLLABORATOR",
    "active_lock_reason": null,
    "body": "As of branch-24.06, GpuOverrides.scala is a file of ~4800 Lines of Code (and growing) consisting of numerous replacement rules.\r\n\r\nIn the center of  the rule is an instance of the Function type \r\n```Scala\r\ndoWrap: (INPUT, RapidsConf, Option[RapidsMeta[_, _, _]], DataFromReplacementRule)\r\n          => SparkPlanMeta[INPUT]\r\n```\r\n\r\nwhich is almost uniformly provided inline compiling down to an anonymous class. Hence, whenever there is an exception in convertToGpu akin to #881\r\n\r\nwe cannot determine which replacement rule is throwing the exception based on the stack trace alone\r\n\t\r\n```\r\nat com.nvidia.spark.rapids.GpuOverrides$$anon$95.$anonfun$convertToGpu$8(GpuOverrides.scala:1221)\r\n```\r\n\r\nwithout having to look at the source code from which the class was compiled\r\n\r\nhttps://github.com/NVIDIA/spark-rapids/blob/d2abd359caaa37477f065911b20397db9dbdccbc/sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuOverrides.scala#L1216-L1222\r\n\r\nNote that the original stack trace of #881 does not mention`SortOrder`\r\n\r\nThis issue proposes a convention to have the function instance be nested in a companion object reflecting in its name the Exec, Expression being replaced. This way we can determine the expression, exec causing the issue without matching the line numbers of the stack trace to the right git hash of GpuOverides.\r\n\r\nWhen this function is implemented in a companion object where the corresponding GPU implementation lives, GpuOverrides will become smaller and the rules more compact and clear.\r\n\r\nSee  #10839 for a potential solution.",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10838/reactions",
        "total_count": 1,
        "+1": 1,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10838/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}