{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/1815",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/1815/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/1815/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/1815/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/1815",
    "id": 816418097,
    "node_id": "MDU6SXNzdWU4MTY0MTgwOTc=",
    "number": 1815,
    "title": "[FEA] Have shuffle/file readers automatically release the Semaphore before I/O",
    "user": {
        "login": "revans2",
        "id": 3441321,
        "node_id": "MDQ6VXNlcjM0NDEzMjE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3441321?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/revans2",
        "html_url": "https://github.com/revans2",
        "followers_url": "https://api.github.com/users/revans2/followers",
        "following_url": "https://api.github.com/users/revans2/following{/other_user}",
        "gists_url": "https://api.github.com/users/revans2/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/revans2/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/revans2/subscriptions",
        "organizations_url": "https://api.github.com/users/revans2/orgs",
        "repos_url": "https://api.github.com/users/revans2/repos",
        "events_url": "https://api.github.com/users/revans2/events{/privacy}",
        "received_events_url": "https://api.github.com/users/revans2/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2094500742,
            "node_id": "MDU6TGFiZWwyMDk0NTAwNzQy",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/performance",
            "name": "performance",
            "color": "d845b1",
            "default": false,
            "description": "A performance related task/issue"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2021-02-25T13:04:30Z",
    "updated_at": "2023-05-15T17:17:09Z",
    "closed_at": null,
    "author_association": "COLLABORATOR",
    "active_lock_reason": null,
    "body": "**Is your feature request related to a problem? Please describe.**\r\nIn practice with spillable algorithms you do not want to release the semaphore before calling `hasNext` or `next` to get another batch. This is because it allows other tasks onto the GPU that will put more batches in memory and cause more memory pressure, which in turn will cause our batches to spill.  Spilling and reading in spilled data are typically blocking operations that happen with the semaphore held. The only time we really want to release the semaphore is if we know that we can overlap slow I/O (reading from a remote disk/etc) with processing on the GPU.\r\n\r\nIf all algorithms are set up properly to never hold onto a non-spillable batch while calling `next` or `hasNext`, which once we have join done should be true, then we can release the semaphore when ever we want, and the only time that we would want to do this is when we are going to do I/O, specifically slow I/O like shuffle or reading input data.\r\n\r\nI would propose that the only time we release the semaphore is for these operations, or when we are transitioning to the CPU for processing, because we don't know how long that is going to take.",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/1815/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/1815/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}