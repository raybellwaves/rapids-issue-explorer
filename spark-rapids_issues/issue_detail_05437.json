{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5437",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5437/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5437/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5437/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/5437",
    "id": 1229055534,
    "node_id": "I_kwDOD7z77c5JQeYu",
    "number": 5437,
    "title": "[FEA] Support fast-fail for invalid values of `buildver`",
    "user": {
        "login": "firestarman",
        "id": 7280411,
        "node_id": "MDQ6VXNlcjcyODA0MTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7280411?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/firestarman",
        "html_url": "https://github.com/firestarman",
        "followers_url": "https://api.github.com/users/firestarman/followers",
        "following_url": "https://api.github.com/users/firestarman/following{/other_user}",
        "gists_url": "https://api.github.com/users/firestarman/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/firestarman/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/firestarman/subscriptions",
        "organizations_url": "https://api.github.com/users/firestarman/orgs",
        "repos_url": "https://api.github.com/users/firestarman/repos",
        "events_url": "https://api.github.com/users/firestarman/events{/privacy}",
        "received_events_url": "https://api.github.com/users/firestarman/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2137414845,
            "node_id": "MDU6TGFiZWwyMTM3NDE0ODQ1",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/build",
            "name": "build",
            "color": "0052cc",
            "default": false,
            "description": "Related to CI / CD or cleanly building"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2022-05-09T01:32:38Z",
    "updated_at": "2022-05-10T20:40:54Z",
    "closed_at": null,
    "author_association": "COLLABORATOR",
    "active_lock_reason": null,
    "body": "**Is your feature request related to a problem? Please describe.**\r\nWhen specifying an invalid value (e.g. 000 ) to the `buildver` property , the build will end up with the error below at the `create-parallel-world` stage which almost reaches to the end of the build process. And the error message is not straightforward enough to get what is doing wrong.\r\n```\r\n[INFO] --- maven-antrun-plugin:3.0.0:run (create-parallel-world) @ rapids-4-spark_2.12 ---\r\n[INFO] Executing tasks\r\n[INFO]      [echo] Preparing parallel worlds with params:\r\n[INFO]      [echo]             included_buildvers=000\r\n[INFO]      [echo]             project.basedir=/home/firestarman/work/projects/on_github/spark-rapids/dist\r\n[INFO]      [echo]             project.build.directory=/home/firestarman/work/projects/on_github/spark-rapids/dist/target\r\n[INFO]      [echo]             spark.version.classifier=spark000\r\n[INFO]      [echo]             maven.repo.local=${maven.repo.local}\r\n[INFO]      [echo]\r\n[INFO]      [echo] copy spark000 aggregator from /home/firestarman/work/projects/on_github/spark-rapids/dist/../aggregator/target\r\n[INFO]      [copy] Copying 1 file to /home/firestarman/work/projects/on_github/spark-rapids/dist/target/deps\r\n[INFO]     [unzip] Expanding: /home/firestarman/work/projects/on_github/spark-rapids/dist/target/deps/rapids-4-spark-aggregator_2.12-22.06.0-SNAPSHOT-spark000.jar into /home/firestarman/work/projects/on_github/spark-rapids/dist/target/parallel-world\r\n[INFO]     [unzip] Expanding: /home/firestarman/work/projects/on_github/spark-rapids/dist/target/deps/rapids-4-spark-aggregator_2.12-22.06.0-SNAPSHOT-spark000.jar into /home/firestarman/work/projects/on_github/spark-rapids/dist/target/parallel-world/spark000\r\n[INFO]      [exec] Retrieving class files hashing to a single value ...\r\n[INFO]      [exec] 1/ SHA1 of all non-META files > tmp-sha1-files.txt\r\n[INFO]      [exec] 2/ make shim column 1 > tmp-shim-sha-package-files.txt\r\n[INFO]      [exec] 3/ sort by path, sha1; output first from each group > tmp-count-shim-sha-package-files.txt\r\n[INFO]      [exec] 4/ files with unique sha1 > /home/firestarman/work/projects/on_github/spark-rapids/dist/target/spark3xx-common.txt\r\n[INFO]      [exec] 5/ retaining a single copy of spark3xx-common classes\r\n[INFO]      [exec] 6/ rsyncing common classes to /home/firstarman/work/projects/on_github/spark-rapids/dist/target/spark3xx-common\r\n[INFO]      [exec] Initializing rsync of from-spark3*-to-spark3xx-common.txt\r\n[ERROR]      [exec] Result: 1\r\n[INFO] ------------------------------------------------------------------------\r\n[INFO] Reactor Summary for RAPIDS Accelerator for Apache Spark Root Project 22.06.0-SNAPSHOT:\r\n[INFO]\r\n[INFO] RAPIDS Accelerator for Apache Spark Root Project ... SUCCESS [01:56 min]\r\n[INFO] RAPIDS Accelerator for Apache Spark Common ......... SUCCESS [02:28 min]\r\n[INFO] RAPIDS Accelerator for Apache Spark SQL Plugin ..... SUCCESS [04:14 min]\r\n[INFO] RAPIDS Accelerator for Apache Spark Shuffle Plugin . SUCCESS [  8.611 s]\r\n[INFO] RAPIDS Accelerator for Apache Spark Scala UDF Plugin SUCCESS [ 18.634 s]\r\n[INFO] RAPIDS Accelerator for Apache Spark Aggregator ..... SUCCESS [ 39.664 s]\r\n[INFO] RAPIDS Accelerator for Apache Spark Distribution ... FAILURE [ 20.167 s]\r\n[INFO] rapids-4-spark-integration-tests_2.12 .............. SKIPPED\r\n[INFO] RAPIDS Accelerator for Apache Spark Tests .......... SKIPPED\r\n[INFO] rapids-4-spark-api-validation ...................... SKIPPED\r\n[INFO] RAPIDS Accelerator for Apache Spark tools .......... SKIPPED\r\n[INFO] ------------------------------------------------------------------------\r\n[INFO] BUILD FAILURE\r\n[INFO] ------------------------------------------------------------------------\r\n[INFO] Total time:  10:06 min\r\n[INFO] Finished at: 2022-05-06T16:51:50+08:00\r\n[INFO] ------------------------------------------------------------------------\r\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-antrun-plugin:3.0.0:run (create-parallel-world) on project rapids-4-spark_2.12: An Ant BuildException has occured: The following error occurred while executing this line:\r\n[ERROR] /home/liangcail/work/projects/on_github/spark-rapids/dist/maven-antrun/build-parallel-worlds.xml:145: exec binary-dedupe.sh failed, exit code is 1, error msg is find: \u2018./parallel-world/spark3*\u2019: No such file or directory\r\n[ERROR] rsync: failed to open files-from file from-spark3*-to-spark3xx-common.txt: No such file or directory\r\n[ERROR] rsync error: syntax or usage error (code 1) at main.c(1596) [client=3.1.3]\r\n[ERROR] around Ant part ...<ant antfile=\"/home/liangcail/work/projects/on_github/spark-rapids/dist/maven-antrun/build-parallel-worlds.xml\" target=\"build-parallel-worlds\" />... @ 9:150 in /home/liangcail/work/projects/on_github/spark-rapids/dist/target/antrun/build-main.xml\r\n[ERROR] -> [Help 1]\r\n[ERROR]\r\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\r\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\r\n```\r\n\r\n\r\n**Describe the solution you'd like**\r\nValidate the value of the `buildver` at an early stage before code compiling, and fail the build if it is invalid. This may be done by the maven enforce plugin as below.\r\n```\r\n+            <plugin>\r\n+                <groupId>org.apache.maven.plugins</groupId>\r\n+                <artifactId>maven-enforcer-plugin</artifactId>\r\n+                <version>3.0.0</version>\r\n+                <executions>\r\n+                    <execution>\r\n+                        <id>enforce-property</id>\r\n+                        <goals>\r\n+                            <goal>enforce</goal>\r\n+                        </goals>\r\n+                        <configuration>\r\n+                            <rules>\r\n+                                <requireProperty>\r\n+                                    <property>buildver</property>\r\n+                                    <message>The 'buildver' property is required.</message>\r\n+                                    <regex>^(24X|311|312(db)?|313|314|320|321cdh|321(db)?|322|330)$</regex>\r\n+                                    <regexMessage>[ERROR] The 'buildver=${buildver}' is not supported. </regexMessage>\r\n+                                </requireProperty>\r\n+                            </rules>\r\n+                            <fail>true</fail>\r\n+                        </configuration>\r\n+                    </execution>\r\n+                </executions>\r\n+            </plugin>\r\n\r\n```\r\n\r\n**Describe alternatives you've considered**\r\nThis may not be the best solution, but we can start with it. The disadvantage is we need to maintain the support list manually. \r\n\r\n",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5437/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5437/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}