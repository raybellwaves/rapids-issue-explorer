{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5832",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5832/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5832/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5832/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/5832",
    "id": 1271400277,
    "node_id": "I_kwDOD7z77c5LyAdV",
    "number": 5832,
    "title": "[BUG] Root-cause exception is missing in UCX shuffle init when native lib is missing",
    "user": {
        "login": "gerashegalov",
        "id": 3187938,
        "node_id": "MDQ6VXNlcjMxODc5Mzg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3187938?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gerashegalov",
        "html_url": "https://github.com/gerashegalov",
        "followers_url": "https://api.github.com/users/gerashegalov/followers",
        "following_url": "https://api.github.com/users/gerashegalov/following{/other_user}",
        "gists_url": "https://api.github.com/users/gerashegalov/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/gerashegalov/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gerashegalov/subscriptions",
        "organizations_url": "https://api.github.com/users/gerashegalov/orgs",
        "repos_url": "https://api.github.com/users/gerashegalov/repos",
        "events_url": "https://api.github.com/users/gerashegalov/events{/privacy}",
        "received_events_url": "https://api.github.com/users/gerashegalov/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2061735874,
            "node_id": "MDU6TGFiZWwyMDYxNzM1ODc0",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/bug",
            "name": "bug",
            "color": "d73a4a",
            "default": true,
            "description": "Something isn't working"
        },
        {
            "id": 4029093938,
            "node_id": "LA_kwDOD7z77c7wJxgy",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/reliability",
            "name": "reliability",
            "color": "2654AF",
            "default": false,
            "description": "Features to improve reliability or bugs that severly impact the reliability of the plugin"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 0,
    "created_at": "2022-06-14T21:48:34Z",
    "updated_at": "2022-07-12T23:23:14Z",
    "closed_at": null,
    "author_association": "COLLABORATOR",
    "active_lock_reason": null,
    "body": "When the user does not have native UCX library installed the RAPIDS shuffle fails with `java.lang.NoClassDefFoundError: Could not initialize class org.openucx.jucx.ucp.UcpConstants`\r\n\r\nThere is no `Caused-by: UnsatisfiedLink` Exception in the log that would help the user fix the issue\r\n\r\n```\r\n>>> spark.read.format('parquet').load('/tmp/df.parquet').selectExpr('avg(a)').collect()\r\n22/06/14 14:43:17 WARN GpuOverrides:\r\n*Exec <HashAggregateExec> will run on GPU\r\n  *Expression <AggregateExpression> avg(a#0) will run on GPU\r\n    *Expression <Average> avg(a#0) will run on GPU\r\n  *Expression <Alias> avg(a#0)#2 AS avg(a)#3 will run on GPU\r\n  *Exec <ShuffleExchangeExec> will run on GPU\r\n    *Partitioning <SinglePartition$> will run on GPU\r\n    *Exec <HashAggregateExec> will run on GPU\r\n      *Expression <AggregateExpression> partial_avg(a#0) will run on GPU\r\n        *Expression <Average> avg(a#0) will run on GPU\r\n      *Exec <FileSourceScanExec> will run on GPU\r\n\r\n22/06/14 14:43:17 WARN GpuOverrides:\r\n*Exec <HashAggregateExec> will run on GPU\r\n  *Expression <AggregateExpression> avg(a#0) will run on GPU\r\n    *Expression <Average> avg(a#0) will run on GPU\r\n  *Expression <Alias> avg(a#0)#2 AS avg(a)#3 will run on GPU\r\n  *Exec <ShuffleExchangeExec> will run on GPU\r\n    *Partitioning <SinglePartition$> will run on GPU\r\n    *Exec <HashAggregateExec> will run on GPU\r\n      *Expression <AggregateExpression> partial_avg(a#0) will run on GPU\r\n        *Expression <Average> avg(a#0) will run on GPU\r\n      *Exec <FileSourceScanExec> will run on GPU\r\n\r\n22/06/14 14:43:17 WARN GpuOverrides:\r\n*Exec <HashAggregateExec> will run on GPU\r\n  *Expression <AggregateExpression> avg(a#0) will run on GPU\r\n    *Expression <Average> avg(a#0) will run on GPU\r\n  *Expression <Alias> avg(a#0)#2 AS avg(a)#3 will run on GPU\r\n  *Exec <ShuffleExchangeExec> will run on GPU\r\n    *Partitioning <SinglePartition$> will run on GPU\r\n    *Exec <HashAggregateExec> will run on GPU\r\n      *Expression <AggregateExpression> partial_avg(a#0) will run on GPU\r\n        *Expression <Average> avg(a#0) will run on GPU\r\n      *Exec <FileSourceScanExec> will run on GPU\r\n\r\n22/06/14 14:43:17 WARN GpuOverrides:\r\n*Exec <ShuffleExchangeExec> will run on GPU\r\n  *Partitioning <SinglePartition$> will run on GPU\r\n  *Exec <HashAggregateExec> will run on GPU\r\n    *Expression <AggregateExpression> partial_avg(a#0) will run on GPU\r\n      *Expression <Average> avg(a#0) will run on GPU\r\n    *Exec <FileSourceScanExec> will run on GPU\r\n\r\n22/06/14 14:43:18 WARN TaskSetManager: Lost task 0.0 in stage 1.0 (TID 1) (172.29.135.230 executor 0): java.lang.NoClassDefFoundError: Could not initialize class org.openucx.jucx.ucp.UcpConstants\r\n        at org.openucx.jucx.ucp.UcpParams.requestTagFeature(UcpParams.java:100)\r\n        at com.nvidia.spark.rapids.shuffle.ucx.UCX.<init>(UCX.scala:73)\r\n        at com.nvidia.spark.rapids.shuffle.ucx.UCXShuffleTransport.ucx$lzycompute(UCXShuffleTransport.scala:71)\r\n        at com.nvidia.spark.rapids.shuffle.ucx.UCXShuffleTransport.ucx(UCXShuffleTransport.scala:69)\r\n        at com.nvidia.spark.rapids.shuffle.ucx.UCXShuffleTransport.makeServer(UCXShuffleTransport.scala:310)\r\n        at org.apache.spark.sql.rapids.RapidsShuffleInternalManagerBase.server$lzycompute(RapidsShuffleInternalManagerBase.scala:315)\r\n        at org.apache.spark.sql.rapids.RapidsShuffleInternalManagerBase.server(RapidsShuffleInternalManagerBase.scala:300)\r\n        at org.apache.spark.sql.rapids.RapidsShuffleInternalManagerBase.getWriter(RapidsShuffleInternalManagerBase.scala:353)\r\n        at org.apache.spark.sql.rapids.ProxyRapidsShuffleInternalManagerBase.getWriter(RapidsShuffleInternalManagerBase.scala:479)\r\n        at org.apache.spark.shuffle.ShuffleWriteProcessor.write(ShuffleWriteProcessor.scala:57)\r\n        at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:99)\r\n        at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:52)\r\n        at org.apache.spark.scheduler.Task.run(Task.scala:131)\r\n        at org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:506)\r\n        at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1462)\r\n        at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:509)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n        at java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\n\r\n_Originally posted by @gerashegalov in https://github.com/NVIDIA/spark-rapids/issues/5818#issuecomment-1155736996_",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5832/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5832/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}