{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10799",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10799/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10799/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10799/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/10799",
    "id": 2291997064,
    "node_id": "I_kwDOD7z77c6InRmI",
    "number": 10799,
    "title": "[FEA] Optimize count distinct performance optimization with null columns reuse and post expand coalesce",
    "user": {
        "login": "winningsix",
        "id": 2278268,
        "node_id": "MDQ6VXNlcjIyNzgyNjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2278268?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/winningsix",
        "html_url": "https://github.com/winningsix",
        "followers_url": "https://api.github.com/users/winningsix/followers",
        "following_url": "https://api.github.com/users/winningsix/following{/other_user}",
        "gists_url": "https://api.github.com/users/winningsix/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/winningsix/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/winningsix/subscriptions",
        "organizations_url": "https://api.github.com/users/winningsix/orgs",
        "repos_url": "https://api.github.com/users/winningsix/repos",
        "events_url": "https://api.github.com/users/winningsix/events{/privacy}",
        "received_events_url": "https://api.github.com/users/winningsix/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2094500742,
            "node_id": "MDU6TGFiZWwyMDk0NTAwNzQy",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/performance",
            "name": "performance",
            "color": "d845b1",
            "default": false,
            "description": "A performance related task/issue"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "binmahone",
        "id": 6416599,
        "node_id": "MDQ6VXNlcjY0MTY1OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6416599?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/binmahone",
        "html_url": "https://github.com/binmahone",
        "followers_url": "https://api.github.com/users/binmahone/followers",
        "following_url": "https://api.github.com/users/binmahone/following{/other_user}",
        "gists_url": "https://api.github.com/users/binmahone/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/binmahone/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/binmahone/subscriptions",
        "organizations_url": "https://api.github.com/users/binmahone/orgs",
        "repos_url": "https://api.github.com/users/binmahone/repos",
        "events_url": "https://api.github.com/users/binmahone/events{/privacy}",
        "received_events_url": "https://api.github.com/users/binmahone/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "binmahone",
            "id": 6416599,
            "node_id": "MDQ6VXNlcjY0MTY1OTk=",
            "avatar_url": "https://avatars.githubusercontent.com/u/6416599?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/binmahone",
            "html_url": "https://github.com/binmahone",
            "followers_url": "https://api.github.com/users/binmahone/followers",
            "following_url": "https://api.github.com/users/binmahone/following{/other_user}",
            "gists_url": "https://api.github.com/users/binmahone/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/binmahone/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/binmahone/subscriptions",
            "organizations_url": "https://api.github.com/users/binmahone/orgs",
            "repos_url": "https://api.github.com/users/binmahone/repos",
            "events_url": "https://api.github.com/users/binmahone/events{/privacy}",
            "received_events_url": "https://api.github.com/users/binmahone/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 0,
    "created_at": "2024-05-13T07:04:19Z",
    "updated_at": "2024-05-28T18:20:51Z",
    "closed_at": null,
    "author_association": "COLLABORATOR",
    "active_lock_reason": null,
    "body": "**Is your feature request related to a problem? Please describe.**\r\nIn Spark, distinct will introduce an expand operator before aggregation. And the things done there are mostly around populating some null columns. However, in current implementation, it shows significant performance issue (e.g., 9X longer time than doing this on 16 CPU cores). We need to catch up performance at least similar level performance.\r\n\r\n**Describe the solution you'd like**\r\nhttps://github.com/NVIDIA/spark-rapids/issues/10560 was already mentioning an approach there. Besides that, from nsys trace, lots of making null columns bring significant negative impacts to overall performance. Also other optimizations came up from @binmahone around introducing a post coalesce after expand to increase batch size for aggregation.\r\n\r\n",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10799/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10799/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}