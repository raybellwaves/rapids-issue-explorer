{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8910",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8910/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8910/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8910/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/8910",
    "id": 1833050227,
    "node_id": "I_kwDOD7z77c5tQiBz",
    "number": 8910,
    "title": "[BUG] Integration tests FAILED on EMR cluster",
    "user": {
        "login": "NvTimLiu",
        "id": 50287591,
        "node_id": "MDQ6VXNlcjUwMjg3NTkx",
        "avatar_url": "https://avatars.githubusercontent.com/u/50287591?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/NvTimLiu",
        "html_url": "https://github.com/NvTimLiu",
        "followers_url": "https://api.github.com/users/NvTimLiu/followers",
        "following_url": "https://api.github.com/users/NvTimLiu/following{/other_user}",
        "gists_url": "https://api.github.com/users/NvTimLiu/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/NvTimLiu/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/NvTimLiu/subscriptions",
        "organizations_url": "https://api.github.com/users/NvTimLiu/orgs",
        "repos_url": "https://api.github.com/users/NvTimLiu/repos",
        "events_url": "https://api.github.com/users/NvTimLiu/events{/privacy}",
        "received_events_url": "https://api.github.com/users/NvTimLiu/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2061735874,
            "node_id": "MDU6TGFiZWwyMDYxNzM1ODc0",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/bug",
            "name": "bug",
            "color": "d73a4a",
            "default": true,
            "description": "Something isn't working"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2023-08-02T12:03:49Z",
    "updated_at": "2023-10-17T21:20:32Z",
    "closed_at": null,
    "author_association": "COLLABORATOR",
    "active_lock_reason": null,
    "body": "**Describe the bug**\r\nPython integration tests failed on latest EMR `6.12.0` cluster [spark-rapids `v23.06.0` jar special for EMR] , FAILED files:\r\n\r\n```\r\n csv_test.py\r\n datasourcev2_read_test.py\r\n json_test.py\r\n mortgage_test.py\r\n orc_test.py\r\n parquet_test.py\r\n row-based_udf_test.py\r\n udf_test.py\r\n```\r\n\r\nFAILED test cases:[consoleText2.txt](https://github.com/NVIDIA/spark-rapids/files/12239763/consoleText2.txt)\r\n\r\n```\r\n =========================== short test summary info ============================\r\n FAILED integration_tests/src/main/python/csv_testm.py::test_csv_scan_with_hidden_metadata_fallback[file_path][INJECT_OOM, ALLOW_NON_GPU(ANY)] - pyspark.errors.exceptions.captured.AnalysisException: [UNRESOLVED_COLUMN.WI...\r\n FAILED integration_tests/src/main/python/csv_test.py::test_csv_scan_with_hidden_metadata_fallback[file_name][ALLOW_NON_GPU(ANY)] - pyspark.errors.exceptions.captured.AnalysisException: [UNRESOLVED_COLUMN.WI...\r\n FAILED integration_tests/src/main/python/csv_test.py::test_csv_scan_with_hidden_metadata_fallback[file_size][ALLOW_NON_GPU(ANY)] - pyspark.errors.exceptions.captured.AnalysisException: [UNRESOLVED_COLUMN.WI...\r\n FAILED integration_tests/src/main/python/csv_test.py::test_csv_scan_with_hidden_metadata_fallback[file_modification_time][ALLOW_NON_GPU(ANY)] - pyspark.errors.exceptions.captured.AnalysisException: [UNRESOLVED_COLUMN.WI...\r\n FAILED integration_tests/src/main/python/csv_test.py::test_csv_datetime_parsing_fallback_cpu_fallback[date.csv-schema0][INJECT_OOM, ALLOW_NON_GPU(FileSourceScanExec)] - pyspark.errors.exceptions.captured.IllegalArgumentException: Part of the pl...\r\n FAILED integration_tests/src/main/python/csv_test.py::test_csv_datetime_parsing_fallback_cpu_fallback[date.csv-schema1][INJECT_OOM, ALLOW_NON_GPU(FileSourceScanExec)] - pyspark.errors.exceptions.captured.IllegalArgumentException: Part of the pl...\r\n FAILED integration_tests/src/main/python/csv_test.py::test_csv_datetime_parsing_fallback_cpu_fallback[ts.csv-schema2][INJECT_OOM, ALLOW_NON_GPU(FileSourceScanExec)] - pyspark.errors.exceptions.captured.IllegalArgumentException: Part of the pl...\r\n = 7 failed, 740 passed, 19223 deselected, 48 xfailed, 8 xpassed, 60 warnings in 577.02s (0:09:37) =\r\n\r\n\r\n =========================== short test summary info ============================\r\n integration_tests/src/main/python/datasourcev2_read_test.py::test_read_int[INJECT_OOM] FAILED [ 20%]\r\n integration_tests/src/main/python/datasourcev2_read_test.py::test_read_strings FAILED [ 40%]\r\n integration_tests/src/main/python/datasourcev2_read_test.py::test_read_all_types FAILED [ 60%]\r\n integration_tests/src/main/python/datasourcev2_read_test.py::test_read_all_types_count FAILED [ 80%]\r\n integration_tests/src/main/python/datasourcev2_read_test.py::test_read_arrow_off[INJECT_OOM] FAILED [100%]\r\n\r\n\r\n =========================== short test summary info ============================\r\n FAILED integration_tests/src/main/python/json_test.py::test_json_read_valid_dates[LEGACY-true-read_json_df-schema0-dates.json][INJECT_OOM, APPROXIMATE_FLOAT, ALLOW_NON_GPU(FileSourceScanExec)] - pyspark.errors.exceptions.captured.IllegalArgumentException: Part of the pl...\r\n FAILED integration_tests/src/main/python/json_test.py::test_json_read_valid_dates[LEGACY-false-read_json_df-schema0-dates.json][INJECT_OOM, APPROXIMATE_FLOAT, ALLOW_NON_GPU(FileSourceScanExec)] - pyspark.errors.exceptions.captured.IllegalArgumentException: Part of the pl...\r\n FAILED integration_tests/src/main/python/json_test.py::test_json_read_invalid_dates[LEGACY-true-read_json_df-schema0-dates_invalid.json][APPROXIMATE_FLOAT, ALLOW_NON_GPU(FileSourceScanExec)] - pyspark.errors.exceptions.captured.IllegalArgumentException: Part of the pl...\r\n FAILED integration_tests/src/main/python/json_test.py::test_json_read_invalid_dates[LEGACY-false-read_json_df-schema0-dates_invalid.json][INJECT_OOM, APPROXIMATE_FLOAT, ALLOW_NON_GPU(FileSourceScanExec)] - pyspark.errors.exceptions.captured.IllegalArgumentException: Part of the pl...\r\n FAILED integration_tests/src/main/python/json_test.py::test_json_read_valid_timestamps[LEGACY-true-read_json_df-schema0-timestamps.json][INJECT_OOM, APPROXIMATE_FLOAT, ALLOW_NON_GPU(FileSourceScanExec)] - pyspark.errors.exceptions.captured.IllegalArgumentException: Part of the pl...\r\n FAILED integration_tests/src/main/python/json_test.py::test_json_read_valid_timestamps[LEGACY-false-read_json_df-schema0-timestamps.json][APPROXIMATE_FLOAT, ALLOW_NON_GPU(FileSourceScanExec)] - pyspark.errors.exceptions.captured.IllegalArgumentException: Part of the pl...\r\n FAILED integration_tests/src/main/python/json_test.py::test_json_datetime_parsing_fallback_cpu_fallback[dates.json-schema0][ALLOW_NON_GPU(FileSourceScanExec)] - pyspark.errors.exceptions.captured.IllegalArgumentException: Part of the pl...\r\n FAILED integration_tests/src/main/python/json_test.py::test_json_datetime_parsing_fallback_cpu_fallback[dates.json-schema1][INJECT_OOM, ALLOW_NON_GPU(FileSourceScanExec)] - pyspark.errors.exceptions.captured.IllegalArgumentException: Part of the pl...\r\n FAILED integration_tests/src/main/python/json_test.py::test_json_datetime_parsing_fallback_cpu_fallback[timestamps.json-schema2][INJECT_OOM, ALLOW_NON_GPU(FileSourceScanExec)] - pyspark.errors.exceptions.captured.IllegalArgumentException: Part of the pl...\r\n = 9 failed, 1143 passed, 12 skipped, 18609 deselected, 93 xfailed, 160 xpassed, 60 warnings in 628.47s (0:10:28) =\r\n\r\n\r\n =========================== short test summary info ============================\r\n FAILED integration_tests/src/main/python/mortgage_test.py::test_mortgage[IGNORE_ORDER, INCOMPAT, APPROXIMATE_FLOAT, ALLOW_NON_GPU(ANY), LIMIT(100000)] - TypeError: 'JavaPackage' object is not callable\r\n =============== 1 failed, 20025 deselected, 60 warnings in 6.76s ===============\r\n\r\n\r\n =========================== short test summary info ============================\r\n FAILED integration_tests/src/main/python/orc_test.py::test_orc_scan_with_hidden_metadata_fallback[file_path][INJECT_OOM, ALLOW_NON_GPU(ANY)] - pyspark.errors.exceptions.captured.AnalysisException: [UNRESOLVED_COLUMN.WI...\r\n FAILED integration_tests/src/main/python/orc_test.py::test_orc_scan_with_hidden_metadata_fallback[file_name][INJECT_OOM, ALLOW_NON_GPU(ANY)] - pyspark.errors.exceptions.captured.AnalysisException: [UNRESOLVED_COLUMN.WI...\r\n FAILED integration_tests/src/main/python/orc_test.py::test_orc_scan_with_hidden_metadata_fallback[file_size][INJECT_OOM, ALLOW_NON_GPU(ANY)] - pyspark.errors.exceptions.captured.AnalysisException: [UNRESOLVED_COLUMN.WI...\r\n FAILED integration_tests/src/main/python/orc_test.py::test_orc_scan_with_hidden_metadata_fallback[file_modification_time][ALLOW_NON_GPU(ANY)] - pyspark.errors.exceptions.captured.AnalysisException: [UNRESOLVED_COLUMN.WI...\r\n FAILED integration_tests/src/main/python/orc_test.py::test_orc_read_count - py4j.protocol.Py4JJavaError: An error occurred while calling z:org.apache.s...\r\n = 5 failed, 1636 passed, 2 skipped, 18339 deselected, 44 xfailed, 60 warnings in 3363.75s (0:56:03) =\r\n\r\n\r\n =========================== short test summary info ============================\r\n FAILED integration_tests/src/main/python/parquet_test.py::test_parquet_read_nano_as_longs_true[ALLOW_NON_GPU(FileSourceScanExec, ColumnarToRowExec)] - py4j.protocol.Py4JJavaError: An error occurred while calling z:org.apache.s...\r\n FAILED integration_tests/src/main/python/parquet_test.py::test_parquet_scan_with_hidden_metadata_fallback[file_path][INJECT_OOM, ALLOW_NON_GPU(ANY)] - pyspark.errors.exceptions.captured.AnalysisException: [UNRESOLVED_COLUMN.WI...\r\n FAILED integration_tests/src/main/python/parquet_test.py::test_parquet_scan_with_hidden_metadata_fallback[file_name][ALLOW_NON_GPU(ANY)] - pyspark.errors.exceptions.captured.AnalysisException: [UNRESOLVED_COLUMN.WI...\r\n FAILED integration_tests/src/main/python/parquet_test.py::test_parquet_scan_with_hidden_metadata_fallback[file_size][ALLOW_NON_GPU(ANY)] - pyspark.errors.exceptions.captured.AnalysisException: [UNRESOLVED_COLUMN.WI...\r\n FAILED integration_tests/src/main/python/parquet_test.py::test_parquet_scan_with_hidden_metadata_fallback[file_modification_time][ALLOW_NON_GPU(ANY)] - pyspark.errors.exceptions.captured.AnalysisException: [UNRESOLVED_COLUMN.WI...\r\n FAILED integration_tests/src/main/python/parquet_test.py::test_parquet_read_count - py4j.protocol.Py4JJavaError: An error occurred while calling z:org.apache.s...\r\n = 6 failed, 2529 passed, 23 skipped, 17116 deselected, 308 xfailed, 44 xpassed, 60 warnings in 5339.85s (1:28:59) =\r\n\r\n\r\n =========================== short test summary info ============================\r\n FAILED integration_tests/src/main/python/row-based_udf_test.py::test_hive_empty_simple_udf[INJECT_OOM] - pyspark.errors.exceptions.captured.AnalysisException: [CANNOT_LOAD_FUNCTION...\r\n FAILED integration_tests/src/main/python/row-based_udf_test.py::test_hive_empty_generic_udf - pyspark.errors.exceptions.captured.AnalysisException: [CANNOT_LOAD_FUNCTION...\r\n =============== 2 failed, 20024 deselected, 60 warnings in 9.52s ===============\r\n\r\n\r\n **Steps/Code to reproduce bug**\r\n1, Create cluster on AWS EMR following [getting-started-aws-emr.md](https://github.com/NVIDIA/spark-rapids/blob/branch-23.08/docs/get-started/getting-started-aws-emr.md) .\r\n2, Run spark-rapids integration tests on the EMR cluster\r\n\r\n\r\n**Environment details (please complete the following information)**\r\n - AWS EMR YARN CLUSTER 6.12.0\r\n\r\n\r\n",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8910/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/8910/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}