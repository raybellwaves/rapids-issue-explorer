{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10005",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10005/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10005/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10005/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/10005",
    "id": 2033397518,
    "node_id": "I_kwDOD7z77c55My8O",
    "number": 10005,
    "title": "[BUG] GPU physical plan missing `ReusedExchange` execs",
    "user": {
        "login": "rongou",
        "id": 497101,
        "node_id": "MDQ6VXNlcjQ5NzEwMQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/497101?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rongou",
        "html_url": "https://github.com/rongou",
        "followers_url": "https://api.github.com/users/rongou/followers",
        "following_url": "https://api.github.com/users/rongou/following{/other_user}",
        "gists_url": "https://api.github.com/users/rongou/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/rongou/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/rongou/subscriptions",
        "organizations_url": "https://api.github.com/users/rongou/orgs",
        "repos_url": "https://api.github.com/users/rongou/repos",
        "events_url": "https://api.github.com/users/rongou/events{/privacy}",
        "received_events_url": "https://api.github.com/users/rongou/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2061735874,
            "node_id": "MDU6TGFiZWwyMDYxNzM1ODc0",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/bug",
            "name": "bug",
            "color": "d73a4a",
            "default": true,
            "description": "Something isn't working"
        },
        {
            "id": 2094500742,
            "node_id": "MDU6TGFiZWwyMDk0NTAwNzQy",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/performance",
            "name": "performance",
            "color": "d845b1",
            "default": false,
            "description": "A performance related task/issue"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 6,
    "created_at": "2023-12-08T22:44:16Z",
    "updated_at": "2024-06-06T18:24:06Z",
    "closed_at": null,
    "author_association": "COLLABORATOR",
    "active_lock_reason": null,
    "body": "**Describe the bug**\r\nIn an effort to improve the accuracy of the qualification tool, I'm trying to match up CPU and GPU execs in the physical plans from event logs for NDS queries, but they don't quite match up. One cause seems to be that the GPU plan for some queries has fewer `ReusedExchange` nodes. This causes `SparkPlanGraph` to interpret the nodes and edges slightly differently between CPU and GPU, leading to a mismatch.\r\n\r\n**Steps/Code to reproduce bug**\r\nRun NDS queries with the Spark RAPIDS plugin disabled and enabled, capture the event logs, and run something like these over the event logs:\r\n```bash\r\ngrep \"isFinalPlan=true\" cpu_logs | grep -o -w '\"ReusedExchange\"' | wc\r\ngrep \"isFinalPlan=true\" gpu_logs | grep -o -w '\"ReusedExchange\"' | wc\r\n```\r\nThey should show different counts.\r\n\r\n**Expected behavior**\r\nThe GPU plan should have the same number of reused exchange execs.\r\n\r\n**Environment details (please complete the following information)**\r\n - Environment location: Both Standalone and Dataproc\r\n - Spark configuration settings related to the issue: seems to happen with various configurations\r\n\r\n**Additional context**\r\nHere are the final plans for query 24a (I removed the textual plan info to make it slightly easier to read).\r\n[cpu.txt](https://github.com/NVIDIA/spark-rapids/files/13621477/cpu.txt)\r\n[gpu.txt](https://github.com/NVIDIA/spark-rapids/files/13621478/gpu.txt)\r\n\r\n",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10005/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/10005/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}