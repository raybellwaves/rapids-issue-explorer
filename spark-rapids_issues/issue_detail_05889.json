{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5889",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5889/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5889/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5889/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/5889",
    "id": 1280864174,
    "node_id": "I_kwDOD7z77c5MWG-u",
    "number": 5889,
    "title": "[BUG] GpuScalarSubquery serializes the subquery plan",
    "user": {
        "login": "jlowe",
        "id": 1360766,
        "node_id": "MDQ6VXNlcjEzNjA3NjY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1360766?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jlowe",
        "html_url": "https://github.com/jlowe",
        "followers_url": "https://api.github.com/users/jlowe/followers",
        "following_url": "https://api.github.com/users/jlowe/following{/other_user}",
        "gists_url": "https://api.github.com/users/jlowe/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/jlowe/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jlowe/subscriptions",
        "organizations_url": "https://api.github.com/users/jlowe/orgs",
        "repos_url": "https://api.github.com/users/jlowe/repos",
        "events_url": "https://api.github.com/users/jlowe/events{/privacy}",
        "received_events_url": "https://api.github.com/users/jlowe/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2061735874,
            "node_id": "MDU6TGFiZWwyMDYxNzM1ODc0",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/bug",
            "name": "bug",
            "color": "d73a4a",
            "default": true,
            "description": "Something isn't working"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2022-06-22T20:42:21Z",
    "updated_at": "2022-06-28T20:51:32Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "**Describe the bug**\r\nSerializing `GpuScalarSubquery` will also serialize the underlying subquery plan which appears to be unnecessary.  The underlying query plan should only be necessary on the driver which ends up collecting the plan result and poking the scalar result into this node for reference on the executor.\r\n\r\n**Steps/Code to reproduce bug**\r\nApply a serialization \"poison pill\" to `GpuExec` with a patch like this:\r\n```patch\r\ndiff --git a/sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuExec.scala b/sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuExec.scala\r\nindex 5284cf8c5..ed2957757 100644\r\n--- a/sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuExec.scala\r\n+++ b/sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuExec.scala\r\n@@ -208,7 +208,11 @@ object GpuExec {\r\n   }\r\n }\r\n \r\n+class SerializationPoisonPill {}\r\n+\r\n trait GpuExec extends SparkPlan with Arm {\r\n+  protected val poisonPill = new SerializationPoisonPill()\r\n+\r\n   import GpuMetric._\r\n   def sparkSession: SparkSession = {\r\n     SparkShimImpl.sessionFromPlan(this)\r\n```\r\n\r\nThen run a query that triggers use of a subquery scalar.  NDS query 58 is one such query that does this.\r\n\r\n**Expected behavior**\r\nThe query plan should not be needlessly serialized in an RDD evaluation closure.\r\n",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5889/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/5889/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}