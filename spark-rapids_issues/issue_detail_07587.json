{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/7587",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/7587/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/7587/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/7587/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/7587",
    "id": 1557364546,
    "node_id": "I_kwDOD7z77c5c039C",
    "number": 7587,
    "title": "Run tests in parallel that use `--packages`",
    "user": {
        "login": "jlowe",
        "id": 1360766,
        "node_id": "MDQ6VXNlcjEzNjA3NjY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1360766?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jlowe",
        "html_url": "https://github.com/jlowe",
        "followers_url": "https://api.github.com/users/jlowe/followers",
        "following_url": "https://api.github.com/users/jlowe/following{/other_user}",
        "gists_url": "https://api.github.com/users/jlowe/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/jlowe/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jlowe/subscriptions",
        "organizations_url": "https://api.github.com/users/jlowe/orgs",
        "repos_url": "https://api.github.com/users/jlowe/repos",
        "events_url": "https://api.github.com/users/jlowe/events{/privacy}",
        "received_events_url": "https://api.github.com/users/jlowe/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2094874947,
            "node_id": "MDU6TGFiZWwyMDk0ODc0OTQ3",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/test",
            "name": "test",
            "color": "60d6d4",
            "default": false,
            "description": "Only impacts tests"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [
        {
            "login": "jlowe",
            "id": 1360766,
            "node_id": "MDQ6VXNlcjEzNjA3NjY=",
            "avatar_url": "https://avatars.githubusercontent.com/u/1360766?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/jlowe",
            "html_url": "https://github.com/jlowe",
            "followers_url": "https://api.github.com/users/jlowe/followers",
            "following_url": "https://api.github.com/users/jlowe/following{/other_user}",
            "gists_url": "https://api.github.com/users/jlowe/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/jlowe/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/jlowe/subscriptions",
            "organizations_url": "https://api.github.com/users/jlowe/orgs",
            "repos_url": "https://api.github.com/users/jlowe/repos",
            "events_url": "https://api.github.com/users/jlowe/events{/privacy}",
            "received_events_url": "https://api.github.com/users/jlowe/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 1,
    "created_at": "2023-01-25T22:36:37Z",
    "updated_at": "2023-01-31T21:26:22Z",
    "closed_at": null,
    "author_association": "MEMBER",
    "active_lock_reason": null,
    "body": "**Is your feature request related to a problem? Please describe.**\r\nCurrently any tests that specify `--packages` to the Spark submit line (usually via `PYSP_TEST_spark_jars_packages`) are run serially (i.e.: TEST_PARALLEL=0 or 1).  This is to avoid multithreaded race issues when dealing with the ivy2 cache being updated by multiple Spark instances.  Tests that do this today include Avro, Delta Lake, and Iceberg\r\n\r\n**Describe the solution you'd like**\r\nThe Databricks Delta Lake tests should not need to be run serially, as they don't use `--packages` to pick up Delta Lake jars.  Delta  Lake support is built-in to the Databricks environment.\r\n\r\nFor the others, we could have the spark submit use a pytest worker specific directory for the ivy2 cache so two instances cannot clobber each other.  The most likely candidate for this directory is the existing scratch directory each pytest xdist worker is using.  Once we've picked a unique directory for each worker to use for ivy2, we can tell ivy to use it by specifying the value to `-Divy.default.ivy.user.dir=` in the Java options for the Spark submit command.\r\n",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/7587/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/7587/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}