{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/7458",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/7458/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/7458/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/7458/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/7458",
    "id": 1520047577,
    "node_id": "I_kwDOD7z77c5amhXZ",
    "number": 7458,
    "title": "Don't fallback to CPU when referencing hidden \"_metadata\" column.",
    "user": {
        "login": "HaoYang670",
        "id": 59198230,
        "node_id": "MDQ6VXNlcjU5MTk4MjMw",
        "avatar_url": "https://avatars.githubusercontent.com/u/59198230?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/HaoYang670",
        "html_url": "https://github.com/HaoYang670",
        "followers_url": "https://api.github.com/users/HaoYang670/followers",
        "following_url": "https://api.github.com/users/HaoYang670/following{/other_user}",
        "gists_url": "https://api.github.com/users/HaoYang670/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/HaoYang670/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/HaoYang670/subscriptions",
        "organizations_url": "https://api.github.com/users/HaoYang670/orgs",
        "repos_url": "https://api.github.com/users/HaoYang670/repos",
        "events_url": "https://api.github.com/users/HaoYang670/events{/privacy}",
        "received_events_url": "https://api.github.com/users/HaoYang670/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 1,
    "created_at": "2023-01-05T04:42:55Z",
    "updated_at": "2023-01-05T16:25:47Z",
    "closed_at": null,
    "author_association": "COLLABORATOR",
    "active_lock_reason": null,
    "body": " We currently do not support \"_metadata\" columns and fall back to the CPU if we see it (this is for Spark 3.3.0).\r\n\r\n```\r\nscala> spark.read.parquet(\"./target/DF\").selectExpr(\"*\", \"_metadata\").show(truncate=false)\r\n23/01/04 16:31:07 WARN GpuOverrides: \r\n!Exec <CollectLimitExec> cannot run on GPU because the Exec CollectLimitExec has been disabled, and is disabled by default because Collect Limit replacement can be slower on the GPU, if huge number of rows in a batch it could help by limiting the number of rows transferred from GPU to CPU. Set spark.rapids.sql.exec.CollectLimitExec to true if you wish to enable it\r\n  @Partitioning <SinglePartition$> could run on GPU\r\n  *Exec <ProjectExec> will run on GPU\r\n    *Expression <Alias> cast(a#64 as string) AS a#80 will run on GPU\r\n      *Expression <Cast> cast(a#64 as string) will run on GPU\r\n    *Expression <Alias> cast(_metadata#70 as string) AS _metadata#83 will run on GPU\r\n      *Expression <Cast> cast(_metadata#70 as string) will run on GPU\r\n    *Exec <ProjectExec> will run on GPU\r\n      *Expression <Alias> named_struct(file_path, file_path#88, file_name, file_name#89, file_size, file_size#90L, file_modification_time, file_modification_time#91) AS _metadata#70 will run on GPU\r\n        *Expression <CreateNamedStruct> named_struct(file_path, file_path#88, file_name, file_name#89, file_size, file_size#90L, file_modification_time, file_modification_time#91) will run on GPU\r\n      !Exec <FileSourceScanExec> cannot run on GPU because hidden metadata columns are not supported on GPU\r\n```\r\n\r\nI am not sure about `row_index`. I don't see that in any of the PRs for the spark issue. It looks like we actually do all of the work for this on the GPU already, so it might be worth not falling back to the CPU and adding in some tests to cover it, but that is a separate issue.\r\n\r\n_Originally posted by @revans2 in https://github.com/NVIDIA/spark-rapids/issues/7452#issuecomment-1371160023_\r\n      ",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/7458/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/7458/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}