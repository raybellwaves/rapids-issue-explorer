{
    "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/2091",
    "repository_url": "https://api.github.com/repos/NVIDIA/spark-rapids",
    "labels_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/2091/labels{/name}",
    "comments_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/2091/comments",
    "events_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/2091/events",
    "html_url": "https://github.com/NVIDIA/spark-rapids/issues/2091",
    "id": 852610629,
    "node_id": "MDU6SXNzdWU4NTI2MTA2Mjk=",
    "number": 2091,
    "title": "[BUG] some tests broken in the JDK11  build",
    "user": {
        "login": "gerashegalov",
        "id": 3187938,
        "node_id": "MDQ6VXNlcjMxODc5Mzg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3187938?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gerashegalov",
        "html_url": "https://github.com/gerashegalov",
        "followers_url": "https://api.github.com/users/gerashegalov/followers",
        "following_url": "https://api.github.com/users/gerashegalov/following{/other_user}",
        "gists_url": "https://api.github.com/users/gerashegalov/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/gerashegalov/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gerashegalov/subscriptions",
        "organizations_url": "https://api.github.com/users/gerashegalov/orgs",
        "repos_url": "https://api.github.com/users/gerashegalov/repos",
        "events_url": "https://api.github.com/users/gerashegalov/events{/privacy}",
        "received_events_url": "https://api.github.com/users/gerashegalov/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 2061735874,
            "node_id": "MDU6TGFiZWwyMDYxNzM1ODc0",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/bug",
            "name": "bug",
            "color": "d73a4a",
            "default": true,
            "description": "Something isn't working"
        },
        {
            "id": 2094874947,
            "node_id": "MDU6TGFiZWwyMDk0ODc0OTQ3",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/test",
            "name": "test",
            "color": "60d6d4",
            "default": false,
            "description": "Only impacts tests"
        },
        {
            "id": 2223784776,
            "node_id": "MDU6TGFiZWwyMjIzNzg0Nzc2",
            "url": "https://api.github.com/repos/NVIDIA/spark-rapids/labels/P1",
            "name": "P1",
            "color": "fbca04",
            "default": false,
            "description": "Nice to have for release"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2021-04-07T17:05:01Z",
    "updated_at": "2022-05-11T19:30:22Z",
    "closed_at": null,
    "author_association": "COLLABORATOR",
    "active_lock_reason": null,
    "body": "**Describe the bug**\r\nsome tests fail when the repo is build using JDK11\r\n\r\n**Steps/Code to reproduce bug**\r\n\r\n```bash \r\nJAVA_HOME=/usr/lib/jvm/java-1.11.0-openjdk-amd64 mvn clean verify -Dcuda.version=cuda11 -Dtests=\"test GpuArrowColumnarBatchBuilder retains reference of ArrowBuf\"\r\n\r\nGpuCoalesceBatchesSuite:\r\n- test GpuArrowColumnarBatchBuilder retains reference of ArrowBuf *** FAILED ***\r\n  java.lang.UnsupportedOperationException: sun.misc.Unsafe or java.nio.DirectByteBuffer.<init>(long, int) not available\r\n  at io.netty.util.internal.PlatformDependent.directBuffer(PlatformDependent.java:490)\r\n  at io.netty.buffer.NettyArrowBuf.getDirectBuffer(NettyArrowBuf.java:243)\r\n  at io.netty.buffer.NettyArrowBuf.nioBuffer(NettyArrowBuf.java:233)\r\n  at io.netty.buffer.NettyArrowBuf.nioBuffer(NettyArrowBuf.java:223)\r\n  at io.netty.buffer.ArrowBuf.nioBuffer(ArrowBuf.java:241)\r\n  at com.nvidia.spark.rapids.shims.spark300.Spark300Shims.getArrowDataBuf(Spark300Shims.scala:486)\r\n  at com.nvidia.spark.rapids.HostColumnarToGpu$.$anonfun$arrowColumnarCopy$1(HostColumnarToGpu.scala:96)\r\n  at com.nvidia.spark.rapids.HostColumnarToGpu$.getBufferAndAddReference$1(HostColumnarToGpu.scala:90)\r\n  at com.nvidia.spark.rapids.HostColumnarToGpu$.arrowColumnarCopy(HostColumnarToGpu.scala:96)\r\n  at com.nvidia.spark.rapids.HostColumnarToGpu.arrowColumnarCopy(HostColumnarToGpu.scala)\r\n```\r\n**Expected behavior**\r\n\r\nJDK 11 is supported with Spark 3 [with the caveat](https://spark.apache.org/docs/3.1.1/#downloading), h/t @pxLi \r\n\r\n> For Python 3.9, Arrow optimization and pandas UDFs might not work due to the supported Python versions in Apache Arrow. Please refer to the latest Python Compatibility page. For Java 11, -Dio.netty.tryReflectionSetAccessible=true is required additionally for Apache Arrow library. This prevents java.lang.UnsupportedOperationException: sun.misc.Unsafe or java.nio.DirectByteBuffer.(long, int) not available when Apache Arrow uses Netty internally.\r\n\r\n**Environment details (please complete the following information)**\r\n - Environment location: building locally on an Ubuntu 18.04 desktop\r\n\r\n```\r\n$ /usr/lib/jvm/java-1.11.0-openjdk-amd64/bin/java -version \r\nopenjdk version \"11.0.10\" 2021-01-19\r\nOpenJDK Runtime Environment (build 11.0.10+9-Ubuntu-0ubuntu1.18.04)\r\nOpenJDK 64-Bit Server VM (build 11.0.10+9-Ubuntu-0ubuntu1.18.04, mixed mode, sharing)\r\n```\r\n**Additional context**\r\nRelated to #2088 ",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/2091/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/NVIDIA/spark-rapids/issues/2091/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}