{
    "url": "https://api.github.com/repos/rapidsai/cudf/issues/15260",
    "repository_url": "https://api.github.com/repos/rapidsai/cudf",
    "labels_url": "https://api.github.com/repos/rapidsai/cudf/issues/15260/labels{/name}",
    "comments_url": "https://api.github.com/repos/rapidsai/cudf/issues/15260/comments",
    "events_url": "https://api.github.com/repos/rapidsai/cudf/issues/15260/events",
    "html_url": "https://github.com/rapidsai/cudf/issues/15260",
    "id": 2176843293,
    "node_id": "I_kwDOBWUGps6Bv_4d",
    "number": 15260,
    "title": "[BUG] mixed_type_as_string throws exception for nested data with nested STRING schema request",
    "user": {
        "login": "revans2",
        "id": 3441321,
        "node_id": "MDQ6VXNlcjM0NDEzMjE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3441321?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/revans2",
        "html_url": "https://github.com/revans2",
        "followers_url": "https://api.github.com/users/revans2/followers",
        "following_url": "https://api.github.com/users/revans2/following{/other_user}",
        "gists_url": "https://api.github.com/users/revans2/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/revans2/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/revans2/subscriptions",
        "organizations_url": "https://api.github.com/users/revans2/orgs",
        "repos_url": "https://api.github.com/users/revans2/repos",
        "events_url": "https://api.github.com/users/revans2/events{/privacy}",
        "received_events_url": "https://api.github.com/users/revans2/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 599626559,
            "node_id": "MDU6TGFiZWw1OTk2MjY1NTk=",
            "url": "https://api.github.com/repos/rapidsai/cudf/labels/bug",
            "name": "bug",
            "color": "d73a4a",
            "default": true,
            "description": "Something isn't working"
        },
        {
            "id": 1139740666,
            "node_id": "MDU6TGFiZWwxMTM5NzQwNjY2",
            "url": "https://api.github.com/repos/rapidsai/cudf/labels/libcudf",
            "name": "libcudf",
            "color": "c5def5",
            "default": false,
            "description": "Affects libcudf (C++/CUDA) code."
        },
        {
            "id": 1185244142,
            "node_id": "MDU6TGFiZWwxMTg1MjQ0MTQy",
            "url": "https://api.github.com/repos/rapidsai/cudf/labels/cuIO",
            "name": "cuIO",
            "color": "fef2c0",
            "default": false,
            "description": "cuIO issue"
        },
        {
            "id": 1405146975,
            "node_id": "MDU6TGFiZWwxNDA1MTQ2OTc1",
            "url": "https://api.github.com/repos/rapidsai/cudf/labels/Spark",
            "name": "Spark",
            "color": "7400ff",
            "default": false,
            "description": "Functionality that helps Spark RAPIDS"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": {
        "url": "https://api.github.com/repos/rapidsai/cudf/milestones/13",
        "html_url": "https://github.com/rapidsai/cudf/milestone/13",
        "labels_url": "https://api.github.com/repos/rapidsai/cudf/milestones/13/labels",
        "id": 8139578,
        "node_id": "MI_kwDOBWUGps4AfDM6",
        "number": 13,
        "title": "Nested JSON reader",
        "description": "Data-parallel reader for nested JSON text data",
        "creator": {
            "login": "GregoryKimball",
            "id": 12725111,
            "node_id": "MDQ6VXNlcjEyNzI1MTEx",
            "avatar_url": "https://avatars.githubusercontent.com/u/12725111?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/GregoryKimball",
            "html_url": "https://github.com/GregoryKimball",
            "followers_url": "https://api.github.com/users/GregoryKimball/followers",
            "following_url": "https://api.github.com/users/GregoryKimball/following{/other_user}",
            "gists_url": "https://api.github.com/users/GregoryKimball/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/GregoryKimball/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/GregoryKimball/subscriptions",
            "organizations_url": "https://api.github.com/users/GregoryKimball/orgs",
            "repos_url": "https://api.github.com/users/GregoryKimball/repos",
            "events_url": "https://api.github.com/users/GregoryKimball/events{/privacy}",
            "received_events_url": "https://api.github.com/users/GregoryKimball/received_events",
            "type": "User",
            "site_admin": false
        },
        "open_issues": 14,
        "closed_issues": 63,
        "state": "open",
        "created_at": "2022-06-28T04:14:28Z",
        "updated_at": "2024-05-31T22:24:52Z",
        "due_on": null,
        "closed_at": null
    },
    "comments": 1,
    "created_at": "2024-03-08T22:02:39Z",
    "updated_at": "2024-03-12T16:07:57Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "**Describe the bug**\r\nThis is very similar to https://github.com/rapidsai/cudf/issues/14239, and because that is not done, then it is fine for this to be a dupe of that.\r\n\r\nIn Spark we are handed a read schema and some JSON data. Our goal is to pull out the parts of the JSON data that match the read schema.  But for strings, this gets to be a little complicated, and any type can be coerced into a string. If the data is an array it is coerced into a string by converting the tokens to a JSON formatted string, if the data is a dict it is coerced into a string the same way. \r\n\r\n`mixed_types_as_string` was added in part to help make this happen, especially in the case of nested types. But that appears to only work at a top level column.\r\n\r\n```\r\n  std::string data = \"{\\\"data\\\": {\\\"A\\\": 0, \\\"B\\\": 1}}\\n{\\\"data\\\": [1,0]}\\n\";\r\n\r\n  std::map<std::string, cudf::io::schema_element> data_types;\r\n  std::map<std::string, cudf::io::schema_element> child_types;\r\n  child_types.insert(std::pair{\"LIST\", cudf::io::schema_element{cudf::data_type{cudf::type_id::STRING, 0}, {}}});\r\n  data_types.insert(std::pair{\"data\", cudf::io::schema_element{cudf::data_type{cudf::type_id::LIST, 0}, child_types}});\r\n\r\n  cudf::io::json_reader_options in_options =\r\n    cudf::io::json_reader_options::builder(cudf::io::source_info{data.data(), data.size()})\r\n      .dtypes(data_types)\r\n      .recovery_mode(cudf::io::json_recovery_mode_t::RECOVER_WITH_NULL)\r\n      .normalize_single_quotes(true)\r\n      .normalize_whitespace(true)\r\n      .mixed_types_as_string(true)\r\n      .keep_quotes(true)\r\n      .lines(true);\r\n  cudf::io::table_with_metadata result = cudf::io::read_json(in_options);\r\n```\r\n\r\nThrows an exception about trying to create a nested column using a fixed width column factory.\r\n\r\n```\r\nC++ exception with description \"CUDF failure at: .../cpp/include/cudf/column/column_factories.hpp:342: Invalid, non-fixed-width type.\" thrown in the test body.\r\n```",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/rapidsai/cudf/issues/15260/reactions",
        "total_count": 1,
        "+1": 1,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/rapidsai/cudf/issues/15260/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}