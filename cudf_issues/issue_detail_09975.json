{
    "url": "https://api.github.com/repos/rapidsai/cudf/issues/9975",
    "repository_url": "https://api.github.com/repos/rapidsai/cudf",
    "labels_url": "https://api.github.com/repos/rapidsai/cudf/issues/9975/labels{/name}",
    "comments_url": "https://api.github.com/repos/rapidsai/cudf/issues/9975/comments",
    "events_url": "https://api.github.com/repos/rapidsai/cudf/issues/9975/events",
    "html_url": "https://github.com/rapidsai/cudf/issues/9975",
    "id": 1094693112,
    "node_id": "I_kwDOBWUGps5BP7D4",
    "number": 9975,
    "title": "[BUG] dask_cudf from_delayed throws exception when meta is included in the from_delayed",
    "user": {
        "login": "mlahir1",
        "id": 24844705,
        "node_id": "MDQ6VXNlcjI0ODQ0NzA1",
        "avatar_url": "https://avatars.githubusercontent.com/u/24844705?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mlahir1",
        "html_url": "https://github.com/mlahir1",
        "followers_url": "https://api.github.com/users/mlahir1/followers",
        "following_url": "https://api.github.com/users/mlahir1/following{/other_user}",
        "gists_url": "https://api.github.com/users/mlahir1/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/mlahir1/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mlahir1/subscriptions",
        "organizations_url": "https://api.github.com/users/mlahir1/orgs",
        "repos_url": "https://api.github.com/users/mlahir1/repos",
        "events_url": "https://api.github.com/users/mlahir1/events{/privacy}",
        "received_events_url": "https://api.github.com/users/mlahir1/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 599626559,
            "node_id": "MDU6TGFiZWw1OTk2MjY1NTk=",
            "url": "https://api.github.com/repos/rapidsai/cudf/labels/bug",
            "name": "bug",
            "color": "d73a4a",
            "default": true,
            "description": "Something isn't working"
        },
        {
            "id": 1139741213,
            "node_id": "MDU6TGFiZWwxMTM5NzQxMjEz",
            "url": "https://api.github.com/repos/rapidsai/cudf/labels/Python",
            "name": "Python",
            "color": "1d76db",
            "default": false,
            "description": "Affects Python cuDF API."
        },
        {
            "id": 1185240898,
            "node_id": "MDU6TGFiZWwxMTg1MjQwODk4",
            "url": "https://api.github.com/repos/rapidsai/cudf/labels/dask",
            "name": "dask",
            "color": "fcc25d",
            "default": false,
            "description": "Dask issue"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": null,
    "assignees": [],
    "milestone": null,
    "comments": 2,
    "created_at": "2022-01-05T19:52:25Z",
    "updated_at": "2024-02-23T18:42:24Z",
    "closed_at": null,
    "author_association": "NONE",
    "active_lock_reason": null,
    "body": "Exception:\r\n\r\n```\r\nColumns: [_col10, _col5, _col0, _col12, visit_date]\r\nIndex: [], 'from_delayed')\r\nkwargs:    {}\r\nException: \"ValueError('Metadata mismatch found in `from_delayed`.\\\\n\\\\nExpected partition of type `pandas.core.frame.DataFrame` but got `cudf.core.dataframe.DataFrame`')\"\r\n```\r\n\r\nReproducer:\r\n```\r\nimport cudf\r\nimport numpy as np\r\nfrom dask.dataframe import from_delayed\r\nfrom dask.delayed import delayed\r\nimport numpy as np\r\nimport cudf\r\nfrom dask.distributed import Client\r\nfrom dask_cuda import LocalCUDACluster\r\nimport dask_cudf\r\n\r\ndf = cudf.DataFrame()\r\nfor i in range(100):\r\n    df[f'_col{i}'] = np.random.randint(20, size=100)\r\n    \r\ndf.to_orc('test1.orc')\r\ndf.to_orc('test0.orc')\r\n\r\nfiles = [(('a',), 'test0.orc'), (('a',), 'test1.orc')]\r\nprint(files)\r\n\r\n\r\ndef rd(f, cols, meta=None):\r\n    if partitions:\r\n        cols = list(set(cols) - set([x[0] for x in partitions]))\r\n    if type(f).__name__ == 'str':\r\n        f = ((), f)\r\n    df = cudf.read_orc(f[1], columns=cols,  use_index=False)\r\n    if partitions:\r\n        for i, col in enumerate(partitions):\r\n            df[col[0]] = f[0][i]\r\n            df[col[0]] = df[col[0]].astype(col[1])\r\n    if meta:\r\n        return df[list(meta.keys())]\r\n    else:\r\n        return df\r\n\r\n\r\npartitions =[('visit_date', 'str')]\r\ncols = ['_col0', '_col12', '_col10', '_col5']\r\nmeta = dict(rd(files[0], cols, meta=None).dtypes)\r\nfor i in partitions:\r\n    meta[i[0]] = i[1]\r\n    \r\nprint(meta)\r\n\r\ndef main():\r\n    c=Client(LocalCUDACluster())\r\n    dfs=[delayed(rd)(f, cols=cols, meta=meta) for f in files[:2]]\r\n    xx = dask_cudf.from_delayed(dfs, meta=meta)\r\n    print(xx.compute())\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    main()\r\n```\r\n\r\nthis issue is very similar to issue here: https://github.com/dask/dask/issues/8528\r\n\r\nthe difference is from_delayed with meta, throws another exception \"The columns in the computed data do not match the columns in the provided metadata\" even though both dfs have same columns and dtypes.\r\nsince we provide the meta here, we run into different issue.",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/rapidsai/cudf/issues/9975/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/rapidsai/cudf/issues/9975/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}