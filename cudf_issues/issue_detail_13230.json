{
    "url": "https://api.github.com/repos/rapidsai/cudf/issues/13230",
    "repository_url": "https://api.github.com/repos/rapidsai/cudf",
    "labels_url": "https://api.github.com/repos/rapidsai/cudf/issues/13230/labels{/name}",
    "comments_url": "https://api.github.com/repos/rapidsai/cudf/issues/13230/comments",
    "events_url": "https://api.github.com/repos/rapidsai/cudf/issues/13230/events",
    "html_url": "https://github.com/rapidsai/cudf/issues/13230",
    "id": 1685588375,
    "node_id": "I_kwDOBWUGps5keAmX",
    "number": 13230,
    "title": "[BUG] libcudf conda packages are shipping dependencies in the package",
    "user": {
        "login": "bdice",
        "id": 3943761,
        "node_id": "MDQ6VXNlcjM5NDM3NjE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3943761?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bdice",
        "html_url": "https://github.com/bdice",
        "followers_url": "https://api.github.com/users/bdice/followers",
        "following_url": "https://api.github.com/users/bdice/following{/other_user}",
        "gists_url": "https://api.github.com/users/bdice/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/bdice/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bdice/subscriptions",
        "organizations_url": "https://api.github.com/users/bdice/orgs",
        "repos_url": "https://api.github.com/users/bdice/repos",
        "events_url": "https://api.github.com/users/bdice/events{/privacy}",
        "received_events_url": "https://api.github.com/users/bdice/received_events",
        "type": "User",
        "site_admin": false
    },
    "labels": [
        {
            "id": 599626559,
            "node_id": "MDU6TGFiZWw1OTk2MjY1NTk=",
            "url": "https://api.github.com/repos/rapidsai/cudf/labels/bug",
            "name": "bug",
            "color": "d73a4a",
            "default": true,
            "description": "Something isn't working"
        },
        {
            "id": 1139740666,
            "node_id": "MDU6TGFiZWwxMTM5NzQwNjY2",
            "url": "https://api.github.com/repos/rapidsai/cudf/labels/libcudf",
            "name": "libcudf",
            "color": "c5def5",
            "default": false,
            "description": "Affects libcudf (C++/CUDA) code."
        },
        {
            "id": 1139750005,
            "node_id": "MDU6TGFiZWwxMTM5NzUwMDA1",
            "url": "https://api.github.com/repos/rapidsai/cudf/labels/CMake",
            "name": "CMake",
            "color": "d319ab",
            "default": false,
            "description": "CMake build issue"
        }
    ],
    "state": "open",
    "locked": false,
    "assignee": {
        "login": "bdice",
        "id": 3943761,
        "node_id": "MDQ6VXNlcjM5NDM3NjE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3943761?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bdice",
        "html_url": "https://github.com/bdice",
        "followers_url": "https://api.github.com/users/bdice/followers",
        "following_url": "https://api.github.com/users/bdice/following{/other_user}",
        "gists_url": "https://api.github.com/users/bdice/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/bdice/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bdice/subscriptions",
        "organizations_url": "https://api.github.com/users/bdice/orgs",
        "repos_url": "https://api.github.com/users/bdice/repos",
        "events_url": "https://api.github.com/users/bdice/events{/privacy}",
        "received_events_url": "https://api.github.com/users/bdice/received_events",
        "type": "User",
        "site_admin": false
    },
    "assignees": [
        {
            "login": "bdice",
            "id": 3943761,
            "node_id": "MDQ6VXNlcjM5NDM3NjE=",
            "avatar_url": "https://avatars.githubusercontent.com/u/3943761?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/bdice",
            "html_url": "https://github.com/bdice",
            "followers_url": "https://api.github.com/users/bdice/followers",
            "following_url": "https://api.github.com/users/bdice/following{/other_user}",
            "gists_url": "https://api.github.com/users/bdice/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/bdice/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/bdice/subscriptions",
            "organizations_url": "https://api.github.com/users/bdice/orgs",
            "repos_url": "https://api.github.com/users/bdice/repos",
            "events_url": "https://api.github.com/users/bdice/events{/privacy}",
            "received_events_url": "https://api.github.com/users/bdice/received_events",
            "type": "User",
            "site_admin": false
        }
    ],
    "milestone": null,
    "comments": 3,
    "created_at": "2023-04-26T19:27:02Z",
    "updated_at": "2024-06-03T22:09:28Z",
    "closed_at": null,
    "author_association": "CONTRIBUTOR",
    "active_lock_reason": null,
    "body": "**Describe the bug**\r\nCurrently, libcudf conda packages are shipping libraries/headers from libcudf dependencies. In particular:\r\n\r\nlibcudf's conda package is 548 MB (all reported sizes are unzipped). It currently ships libraries/headers from:\r\n- kvikio (< 1 MB)\r\n- libcudacxx (5.2 MB)\r\n- nvbench (4.1 MB)\r\n- nvcomp (46 MB)\r\n\r\n**Expected behavior**\r\nlibcudf conda packages should not ship its dependencies, but should instead list other conda packages as dependencies. This will prevent files from outside libcudf from being shipped in libcudf packages.\r\n\r\n### Specific proposals for resolution\r\n\r\n**kvikio (easy)**\r\nkvikio should be easy to fix. RAPIDS already produces conda packages of kvikio and just need to use those, rather than letting it be found via CPM and repackaged in libcudf.\r\n\r\n\u2714\ufe0f Resolved in: https://github.com/rapidsai/cudf/pull/13231\r\n\r\n**libcudacxx (medium difficulty)**\r\n`libcudacxx` is part of CCCL, along with Thrust and CUB. Historically, librmm has shipped most of the CCCL headers in `include/rapids` because they've been found by CPM during the librmm build and repackaged there. However, this is not ideal. libcudacxx is an exception to librmm shipping a RAPIDS-vendored CCCL because it was not needed by librmm -- only libcudf. I suspect we're repackaging libcudacxx in many RAPIDS packages right now. The fix here is to adopt [rapids-core-dependencies](https://github.com/rapidsai/rapids-cmake/tree/branch-23.06/conda/recipes/rapids_core_dependencies) across all of RAPIDS, which should be mostly ready for use, if I recall correctly.\r\n\r\n**nvbench (very difficult)**\r\nIdeally, `nvbench` should be its own conda package, but we often require patched versions. Therefore, we should consider moving nvbench headers to a special subdirectory `include/rapids` as we do for CCCL (see https://github.com/rapidsai/rapids-cmake/pull/98). We should also do a more granular review to decide if (and where) we want to be shipping files like `bin/nvbench-ctl` or `lib/objects-Release/nvbench.main/main.cu.o`.\r\n\r\n**nvcomp (medium difficulty)**\r\n`nvcomp` should be shipping in a separate conda package (probably on either the rapidsai or nvidia channels). Then we make it a dependency of libcudf. It is the largest component of libcudf that is being repackaged (around 10% of libcudf's size).\r\n\r\n\u2714\ufe0f Resolved in: https://github.com/rapidsai/cudf/pull/13566\r\n\r\ncc: @vuule (with whom I discussed this)",
    "closed_by": null,
    "reactions": {
        "url": "https://api.github.com/repos/rapidsai/cudf/issues/13230/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
    },
    "timeline_url": "https://api.github.com/repos/rapidsai/cudf/issues/13230/timeline",
    "performed_via_github_app": null,
    "state_reason": null
}